<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>19-CountDownLatchå’ŒCyclicBarrierï¼šå¦‚ä½•è®©å¤šçº¿ç¨‹æ­¥è°ƒä¸€è‡´ï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>19-CountDownLatchå’ŒCyclicBarrierï¼šå¦‚ä½•è®©å¤šçº¿ç¨‹æ­¥è°ƒä¸€è‡´ï¼Ÿ</h1>
<p>å‰å‡ å¤©è€æ¿çªç„¶åŒ†åŒ†å¿™å¿™è¿‡æ¥ï¼Œè¯´å¯¹è´¦ç³»ç»Ÿæœ€è¿‘è¶Šæ¥è¶Šæ…¢äº†ï¼Œèƒ½ä¸èƒ½å¿«é€Ÿä¼˜åŒ–ä¸€ä¸‹ã€‚æˆ‘äº†è§£äº†å¯¹è´¦ç³»ç»Ÿçš„ä¸šåŠ¡åï¼Œå‘ç°è¿˜æ˜¯æŒºç®€å•çš„ï¼Œç”¨æˆ·é€šè¿‡åœ¨çº¿å•†åŸä¸‹å•ï¼Œä¼šç”Ÿæˆç”µå­è®¢å•ï¼Œä¿å­˜åœ¨è®¢å•åº“ï¼›ä¹‹åç‰©æµä¼šç”Ÿæˆæ´¾é€å•ç»™ç”¨æˆ·å‘è´§ï¼Œæ´¾é€å•ä¿å­˜åœ¨æ´¾é€å•åº“ã€‚ä¸ºäº†é˜²æ­¢æ¼æ´¾é€æˆ–è€…é‡å¤æ´¾é€ï¼Œå¯¹è´¦ç³»ç»Ÿæ¯å¤©è¿˜ä¼šæ ¡éªŒæ˜¯å¦å­˜åœ¨å¼‚å¸¸è®¢å•ã€‚</p><p>å¯¹è´¦ç³»ç»Ÿçš„å¤„ç†é€»è¾‘å¾ˆç®€å•ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„å¯¹è´¦ç³»ç»Ÿæµç¨‹å›¾ã€‚ç›®å‰å¯¹è´¦ç³»ç»Ÿçš„å¤„ç†é€»è¾‘æ˜¯é¦–å…ˆæŸ¥è¯¢è®¢å•ï¼Œç„¶åæŸ¥è¯¢æ´¾é€å•ï¼Œä¹‹åå¯¹æ¯”è®¢å•å’Œæ´¾é€å•ï¼Œå°†å·®å¼‚å†™å…¥å·®å¼‚åº“ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/06/fe/068418bdc371b8a1b4b740428a3b3ffe.png" alt=""></p><center><span class="reference">å¯¹è´¦ç³»ç»Ÿæµç¨‹å›¾</span></center><p>å¯¹è´¦ç³»ç»Ÿçš„ä»£ç æŠ½è±¡ä¹‹åï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå•çº¿ç¨‹é‡Œé¢å¾ªç¯æŸ¥è¯¢è®¢å•ã€æ´¾é€å•ï¼Œç„¶åæ‰§è¡Œå¯¹è´¦ï¼Œæœ€åå°†å†™å…¥å·®å¼‚åº“ã€‚</p><pre><code>while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
  // æŸ¥è¯¢æœªå¯¹è´¦è®¢å•
  pos = getPOrders();
  // æŸ¥è¯¢æ´¾é€å•
  dos = getDOrders();
  // æ‰§è¡Œå¯¹è´¦æ“ä½œ
  diff = check(pos, dos);
  // å·®å¼‚å†™å…¥å·®å¼‚åº“
  save(diff);
} 
</code></pre><h2>åˆ©ç”¨å¹¶è¡Œä¼˜åŒ–å¯¹è´¦ç³»ç»Ÿ</h2><p>è€æ¿è¦æˆ‘ä¼˜åŒ–æ€§èƒ½ï¼Œé‚£æˆ‘å°±é¦–å…ˆè¦æ‰¾åˆ°è¿™ä¸ªå¯¹è´¦ç³»ç»Ÿçš„ç“¶é¢ˆæ‰€åœ¨ã€‚</p><p>ç›®å‰çš„å¯¹è´¦ç³»ç»Ÿï¼Œç”±äºè®¢å•é‡å’Œæ´¾é€å•é‡å·¨å¤§ï¼Œæ‰€ä»¥æŸ¥è¯¢æœªå¯¹è´¦è®¢å•getPOrders()å’ŒæŸ¥è¯¢æ´¾é€å•getDOrders()ç›¸å¯¹è¾ƒæ…¢ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•å¿«é€Ÿä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿç›®å‰å¯¹è´¦ç³»ç»Ÿæ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå›¾å½¢åŒ–åæ˜¯ä¸‹å›¾è¿™ä¸ªæ ·å­ã€‚å¯¹äºä¸²è¡ŒåŒ–çš„ç³»ç»Ÿï¼Œä¼˜åŒ–æ€§èƒ½é¦–å…ˆæƒ³åˆ°çš„æ˜¯èƒ½å¦<strong>åˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†</strong>ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/cd/a5/cd997c259e4165c046e79e766abfe2a5.png" alt=""></p><center><span class="reference">å¯¹è´¦ç³»ç»Ÿå•çº¿ç¨‹æ‰§è¡Œç¤ºæ„å›¾</span></center><p>æ‰€ä»¥ï¼Œè¿™é‡Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹å‡ºæ¥è¿™ä¸ªå¯¹è´¦ç³»ç»Ÿé‡Œçš„ç“¶é¢ˆï¼šæŸ¥è¯¢æœªå¯¹è´¦è®¢å•getPOrders()å’ŒæŸ¥è¯¢æ´¾é€å•getDOrders()æ˜¯å¦å¯ä»¥å¹¶è¡Œå¤„ç†å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œå¹¶æ²¡æœ‰å…ˆåé¡ºåºçš„ä¾èµ–ã€‚è¿™ä¸¤ä¸ªæœ€è€—æ—¶çš„æ“ä½œå¹¶è¡Œä¹‹åï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹æ¯”ä¸€ä¸‹å•çº¿ç¨‹çš„æ‰§è¡Œç¤ºæ„å›¾ï¼Œä½ ä¼šå‘ç°åŒç­‰æ—¶é—´é‡Œï¼Œå¹¶è¡Œæ‰§è¡Œçš„ååé‡è¿‘ä¹å•çº¿ç¨‹çš„2å€ï¼Œä¼˜åŒ–æ•ˆæœè¿˜æ˜¯ç›¸å¯¹æ˜æ˜¾çš„ã€‚</p><!-- [[[read_end]]] --><p><img src="https://static001.geekbang.org/resource/image/a5/3b/a563c39ece918578ad2ff33ab5f3743b.png" alt=""></p><center><span class="reference">å¯¹è´¦ç³»ç»Ÿå¹¶è¡Œæ‰§è¡Œç¤ºæ„å›¾</span></center><p>æ€è·¯æœ‰äº†ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•ç”¨ä»£ç å®ç°ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹T1å’ŒT2ï¼Œå¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢æœªå¯¹è´¦è®¢å•getPOrders()å’ŒæŸ¥è¯¢æ´¾é€å•getDOrders()è¿™ä¸¤ä¸ªæ“ä½œã€‚åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œå¯¹è´¦æ“ä½œcheck()å’Œå·®å¼‚å†™å…¥save()ä¸¤ä¸ªæ“ä½œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…çº¿ç¨‹T1å’ŒT2æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œcheck()å’Œsave()è¿™ä¸¤ä¸ªæ“ä½œï¼Œä¸ºæ­¤æˆ‘ä»¬é€šè¿‡è°ƒç”¨T1.join()å’ŒT2.join()æ¥å®ç°ç­‰å¾…ï¼Œå½“T1å’ŒT2çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè°ƒç”¨T1.join()å’ŒT2.join()çš„ä¸»çº¿ç¨‹å°±ä¼šä»é˜»å¡æ€è¢«å”¤é†’ï¼Œä»è€Œæ‰§è¡Œä¹‹åçš„check()å’Œsave()ã€‚</p><pre><code>while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
  // æŸ¥è¯¢æœªå¯¹è´¦è®¢å•
  Thread T1 = new Thread(()-&gt;{
    pos = getPOrders();
  });
  T1.start();
  // æŸ¥è¯¢æ´¾é€å•
  Thread T2 = new Thread(()-&gt;{
    dos = getDOrders();
  });
  T2.start();
  // ç­‰å¾…T1ã€T2ç»“æŸ
  T1.join();
  T2.join();
  // æ‰§è¡Œå¯¹è´¦æ“ä½œ
  diff = check(pos, dos);
  // å·®å¼‚å†™å…¥å·®å¼‚åº“
  save(diff);
} 
</code></pre><h2>ç”¨CountDownLatchå®ç°çº¿ç¨‹ç­‰å¾…</h2><p>ç»è¿‡ä¸Šé¢çš„ä¼˜åŒ–ä¹‹åï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è·Ÿè€æ¿æ±‡æŠ¥æ”¶å·¥äº†ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹ç¾ä¸­ä¸è¶³ï¼Œç›¸ä¿¡ä½ ä¹Ÿå‘ç°äº†ï¼Œwhileå¾ªç¯é‡Œé¢æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè€Œåˆ›å»ºçº¿ç¨‹å¯æ˜¯ä¸ªè€—æ—¶çš„æ“ä½œã€‚æ‰€ä»¥æœ€å¥½æ˜¯åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹èƒ½å¤Ÿå¾ªç¯åˆ©ç”¨ï¼Œä¼°è®¡è¿™æ—¶ä½ å·²ç»æƒ³åˆ°çº¿ç¨‹æ± äº†ï¼Œæ˜¯çš„ï¼Œçº¿ç¨‹æ± å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è€Œä¸‹é¢çš„ä»£ç å°±æ˜¯ç”¨çº¿ç¨‹æ± ä¼˜åŒ–åçš„ï¼šæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå›ºå®šå¤§å°ä¸º2çš„çº¿ç¨‹æ± ï¼Œä¹‹ååœ¨whileå¾ªç¯é‡Œé‡å¤åˆ©ç”¨ã€‚ä¸€åˆ‡çœ‹ä¸Šå»éƒ½å¾ˆé¡ºåˆ©ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å¥½åƒæ— è§£äº†ï¼Œé‚£å°±æ˜¯ä¸»çº¿ç¨‹å¦‚ä½•çŸ¥é“getPOrders()å’ŒgetDOrders()è¿™ä¸¤ä¸ªæ“ä½œä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œã€‚å‰é¢ä¸»çº¿ç¨‹é€šè¿‡è°ƒç”¨çº¿ç¨‹T1å’ŒT2çš„join()æ–¹æ³•æ¥ç­‰å¾…çº¿ç¨‹T1å’ŒT2é€€å‡ºï¼Œä½†æ˜¯åœ¨çº¿ç¨‹æ± çš„æ–¹æ¡ˆé‡Œï¼Œçº¿ç¨‹æ ¹æœ¬å°±ä¸ä¼šé€€å‡ºï¼Œæ‰€ä»¥join()æ–¹æ³•å·²ç»å¤±æ•ˆäº†ã€‚</p><pre><code>// åˆ›å»º2ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± 
Executor executor = 
  Executors.newFixedThreadPool(2);
while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
  // æŸ¥è¯¢æœªå¯¹è´¦è®¢å•
  executor.execute(()-&gt; {
    pos = getPOrders();
  });
  // æŸ¥è¯¢æ´¾é€å•
  executor.execute(()-&gt; {
    dos = getDOrders();
  });
  
  /* ï¼Ÿï¼Ÿå¦‚ä½•å®ç°ç­‰å¾…ï¼Ÿï¼Ÿ*/
  
  // æ‰§è¡Œå¯¹è´¦æ“ä½œ
  diff = check(pos, dos);
  // å·®å¼‚å†™å…¥å·®å¼‚åº“
  save(diff);
}   
</code></pre><p>é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½ å¯ä»¥å¼€åŠ¨è„‘ç­‹æƒ³å‡ºå¾ˆå¤šåŠæ³•ï¼Œæœ€ç›´æ¥çš„åŠæ³•æ˜¯å¼„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåˆå§‹å€¼è®¾ç½®æˆ2ï¼Œå½“æ‰§è¡Œå®Œ<code>pos = getPOrders();</code>è¿™ä¸ªæ“ä½œä¹‹åå°†è®¡æ•°å™¨å‡1ï¼Œæ‰§è¡Œå®Œ<code>dos = getDOrders();</code>ä¹‹åä¹Ÿå°†è®¡æ•°å™¨å‡1ï¼Œåœ¨ä¸»çº¿ç¨‹é‡Œï¼Œç­‰å¾…è®¡æ•°å™¨ç­‰äº0ï¼›å½“è®¡æ•°å™¨ç­‰äº0æ—¶ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œæ‰§è¡Œå®Œäº†ã€‚ç­‰å¾…è®¡æ•°å™¨ç­‰äº0å…¶å®å°±æ˜¯ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œç”¨ç®¡ç¨‹å®ç°èµ·æ¥ä¹Ÿå¾ˆç®€å•ã€‚</p><p>ä¸è¿‡æˆ‘å¹¶ä¸å»ºè®®ä½ åœ¨å®é™…é¡¹ç›®ä¸­å»å®ç°ä¸Šé¢çš„æ–¹æ¡ˆï¼Œå› ä¸ºJavaå¹¶å‘åŒ…é‡Œå·²ç»æä¾›äº†å®ç°ç±»ä¼¼åŠŸèƒ½çš„å·¥å…·ç±»ï¼š<strong>CountDownLatch</strong>ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨whileå¾ªç¯é‡Œé¢ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªCountDownLatchï¼Œè®¡æ•°å™¨çš„åˆå§‹å€¼ç­‰äº2ï¼Œä¹‹ååœ¨<code>pos = getPOrders();</code>å’Œ<code>dos = getDOrders();</code>ä¸¤æ¡è¯­å¥çš„åé¢å¯¹è®¡æ•°å™¨æ‰§è¡Œå‡1æ“ä½œï¼Œè¿™ä¸ªå¯¹è®¡æ•°å™¨å‡1çš„æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨ <code>latch.countDown();</code> æ¥å®ç°çš„ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>latch.await()</code> æ¥å®ç°å¯¹è®¡æ•°å™¨ç­‰äº0çš„ç­‰å¾…ã€‚</p><pre><code>// åˆ›å»º2ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± 
Executor executor = 
  Executors.newFixedThreadPool(2);
while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
  // è®¡æ•°å™¨åˆå§‹åŒ–ä¸º2
  CountDownLatch latch = 
    new CountDownLatch(2);
  // æŸ¥è¯¢æœªå¯¹è´¦è®¢å•
  executor.execute(()-&gt; {
    pos = getPOrders();
    latch.countDown();
  });
  // æŸ¥è¯¢æ´¾é€å•
  executor.execute(()-&gt; {
    dos = getDOrders();
    latch.countDown();
  });
  
  // ç­‰å¾…ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œç»“æŸ
  latch.await();
  
  // æ‰§è¡Œå¯¹è´¦æ“ä½œ
  diff = check(pos, dos);
  // å·®å¼‚å†™å…¥å·®å¼‚åº“
  save(diff);
}
</code></pre><h2>è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½</h2><p>ç»è¿‡ä¸Šé¢çš„é‡é‡ä¼˜åŒ–ä¹‹åï¼Œé•¿å‡ºä¸€å£æ°”ï¼Œç»ˆäºå¯ä»¥äº¤ä»˜äº†ã€‚ä¸è¿‡åœ¨äº¤ä»˜ä¹‹å‰è¿˜éœ€è¦å†æ¬¡å®¡è§†ä¸€ç•ªï¼Œçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ä¼˜åŒ–çš„ä½™åœ°ï¼Œä»”ç»†çœ‹è¿˜æ˜¯æœ‰çš„ã€‚</p><p>å‰é¢æˆ‘ä»¬å°†getPOrders()å’ŒgetDOrders()è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå¹¶è¡Œäº†ï¼Œä½†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå’Œå¯¹è´¦æ“ä½œcheck()ã€save()ä¹‹é—´è¿˜æ˜¯ä¸²è¡Œçš„ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸¤ä¸ªæŸ¥è¯¢æ“ä½œå’Œå¯¹è´¦æ“ä½œä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œå¯¹è´¦æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶å»æ‰§è¡Œä¸‹ä¸€è½®çš„æŸ¥è¯¢æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥å½¢è±¡åŒ–åœ°è¡¨è¿°ä¸ºä¸‹é¢è¿™å¹…ç¤ºæ„å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/e6/8b/e663d90f49d9666e618ac1370ccca58b.png" alt=""></p><center><span class="reference">å®Œå…¨å¹¶è¡Œæ‰§è¡Œç¤ºæ„å›¾</span></center><p>é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°è¿™æ­¥ä¼˜åŒ–ï¼Œä¸¤æ¬¡æŸ¥è¯¢æ“ä½œèƒ½å¤Ÿå’Œå¯¹è´¦æ“ä½œå¹¶è¡Œï¼Œå¯¹è´¦æ“ä½œè¿˜ä¾èµ–æŸ¥è¯¢æ“ä½œçš„ç»“æœï¼Œè¿™æ˜æ˜¾æœ‰ç‚¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„æ„æ€ï¼Œä¸¤æ¬¡æŸ¥è¯¢æ“ä½œæ˜¯ç”Ÿäº§è€…ï¼Œå¯¹è´¦æ“ä½œæ˜¯æ¶ˆè´¹è€…ã€‚æ—¢ç„¶æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œé‚£å°±éœ€è¦æœ‰ä¸ªé˜Ÿåˆ—ï¼Œæ¥ä¿å­˜ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…åˆ™ä»è¿™ä¸ªé˜Ÿåˆ—æ¶ˆè´¹æ•°æ®ã€‚</p><p>ä¸è¿‡é’ˆå¯¹å¯¹è´¦è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘è®¾è®¡äº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¹‹é—´è¿˜æœ‰å¯¹åº”å…³ç³»ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¢å•æŸ¥è¯¢æ“ä½œå°†è®¢å•æŸ¥è¯¢ç»“æœæ’å…¥è®¢å•é˜Ÿåˆ—ï¼Œæ´¾é€å•æŸ¥è¯¢æ“ä½œå°†æ´¾é€å•æ’å…¥æ´¾é€å•é˜Ÿåˆ—ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¹‹é—´æ˜¯æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»çš„ã€‚ä¸¤ä¸ªé˜Ÿåˆ—çš„å¥½å¤„æ˜¯ï¼Œå¯¹è´¦æ“ä½œå¯ä»¥æ¯æ¬¡ä»è®¢å•é˜Ÿåˆ—å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä»æ´¾é€å•é˜Ÿåˆ—å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå¯¹è¿™ä¸¤ä¸ªå…ƒç´ æ‰§è¡Œå¯¹è´¦æ“ä½œï¼Œè¿™æ ·æ•°æ®ä¸€å®šä¸ä¼šä¹±æ‰ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/22/da/22e8ba1c04a3bc2605b98376ed6832da.png" alt=""></p><center><span class="reference">åŒé˜Ÿåˆ—ç¤ºæ„å›¾</span></center><p>ä¸‹é¢å†æ¥çœ‹å¦‚ä½•ç”¨åŒé˜Ÿåˆ—æ¥å®ç°å®Œå…¨çš„å¹¶è¡Œã€‚ä¸€ä¸ªæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯ï¼šä¸€ä¸ªçº¿ç¨‹T1æ‰§è¡Œè®¢å•çš„æŸ¥è¯¢å·¥ä½œï¼Œä¸€ä¸ªçº¿ç¨‹T2æ‰§è¡Œæ´¾é€å•çš„æŸ¥è¯¢å·¥ä½œï¼Œå½“çº¿ç¨‹T1å’ŒT2éƒ½å„è‡ªç”Ÿäº§å®Œ1æ¡æ•°æ®çš„æ—¶å€™ï¼Œé€šçŸ¥çº¿ç¨‹T3æ‰§è¡Œå¯¹è´¦æ“ä½œã€‚è¿™ä¸ªæƒ³æ³•è™½çœ‹ä¸Šå»ç®€å•ï¼Œä½†å…¶å®è¿˜éšè—ç€ä¸€ä¸ªæ¡ä»¶ï¼Œé‚£å°±æ˜¯çº¿ç¨‹T1å’Œçº¿ç¨‹T2çš„å·¥ä½œè¦æ­¥è°ƒä¸€è‡´ï¼Œä¸èƒ½ä¸€ä¸ªè·‘å¾—å¤ªå¿«ï¼Œä¸€ä¸ªè·‘å¾—å¤ªæ…¢ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½åšåˆ°å„è‡ªç”Ÿäº§å®Œ1æ¡æ•°æ®çš„æ—¶å€™ï¼Œé€šçŸ¥çº¿ç¨‹T3ã€‚</p><p>ä¸‹é¢è¿™å¹…å›¾å½¢è±¡åœ°æè¿°äº†ä¸Šé¢çš„æ„å›¾ï¼šçº¿ç¨‹T1å’Œçº¿ç¨‹T2åªæœ‰éƒ½ç”Ÿäº§å®Œ1æ¡æ•°æ®çš„æ—¶å€™ï¼Œæ‰èƒ½ä¸€èµ·å‘ä¸‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹T1å’Œçº¿ç¨‹T2è¦äº’ç›¸ç­‰å¾…ï¼Œæ­¥è°ƒè¦ä¸€è‡´ï¼›åŒæ—¶å½“çº¿ç¨‹T1å’ŒT2éƒ½ç”Ÿäº§å®Œä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œè¿˜è¦èƒ½å¤Ÿé€šçŸ¥çº¿ç¨‹T3æ‰§è¡Œå¯¹è´¦æ“ä½œã€‚</p><p><img src="https://static001.geekbang.org/resource/image/65/ad/6593a10a393d9310a8f864730f7426ad.png" alt=""></p><center><span class="reference">åŒæ­¥æ‰§è¡Œç¤ºæ„å›¾</span></center><h2>ç”¨CyclicBarrierå®ç°çº¿ç¨‹åŒæ­¥</h2><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å®ç°ä¸Šé¢æåˆ°çš„æ–¹æ¡ˆã€‚è¿™ä¸ªæ–¹æ¡ˆçš„éš¾ç‚¹æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯çº¿ç¨‹T1å’ŒT2è¦åšåˆ°æ­¥è°ƒä¸€è‡´ï¼Œå¦ä¸€ä¸ªæ˜¯è¦èƒ½å¤Ÿé€šçŸ¥åˆ°çº¿ç¨‹T3ã€‚</p><p>ä½ ä¾ç„¶å¯ä»¥åˆ©ç”¨ä¸€ä¸ªè®¡æ•°å™¨æ¥è§£å†³è¿™ä¸¤ä¸ªéš¾ç‚¹ï¼Œè®¡æ•°å™¨åˆå§‹åŒ–ä¸º2ï¼Œçº¿ç¨‹T1å’ŒT2ç”Ÿäº§å®Œä¸€æ¡æ•°æ®éƒ½å°†è®¡æ•°å™¨å‡1ï¼Œå¦‚æœè®¡æ•°å™¨å¤§äº0åˆ™çº¿ç¨‹T1æˆ–è€…T2ç­‰å¾…ã€‚å¦‚æœè®¡æ•°å™¨ç­‰äº0ï¼Œåˆ™é€šçŸ¥çº¿ç¨‹T3ï¼Œå¹¶å”¤é†’ç­‰å¾…çš„çº¿ç¨‹T1æˆ–è€…T2ï¼Œä¸æ­¤åŒæ—¶ï¼Œå°†è®¡æ•°å™¨é‡ç½®ä¸º2ï¼Œè¿™æ ·çº¿ç¨‹T1å’Œçº¿ç¨‹T2ç”Ÿäº§ä¸‹ä¸€æ¡æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç»§ç»­ä½¿ç”¨è¿™ä¸ªè®¡æ•°å™¨äº†ã€‚</p><p>åŒæ ·ï¼Œè¿˜æ˜¯å»ºè®®ä½ ä¸è¦åœ¨å®é™…é¡¹ç›®ä¸­è¿™ä¹ˆåšï¼Œå› ä¸ºJavaå¹¶å‘åŒ…é‡Œä¹Ÿå·²ç»æä¾›äº†ç›¸å…³çš„å·¥å…·ç±»ï¼š<strong>CyclicBarrier</strong>ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªè®¡æ•°å™¨åˆå§‹å€¼ä¸º2çš„CyclicBarrierï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯åˆ›å»ºCyclicBarrierçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ä¼ å…¥äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“è®¡æ•°å™¨å‡åˆ°0çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</p><p>çº¿ç¨‹T1è´Ÿè´£æŸ¥è¯¢è®¢å•ï¼Œå½“æŸ¥å‡ºä¸€æ¡æ—¶ï¼Œè°ƒç”¨ <code>barrier.await()</code> æ¥å°†è®¡æ•°å™¨å‡1ï¼ŒåŒæ—¶ç­‰å¾…è®¡æ•°å™¨å˜æˆ0ï¼›çº¿ç¨‹T2è´Ÿè´£æŸ¥è¯¢æ´¾é€å•ï¼Œå½“æŸ¥å‡ºä¸€æ¡æ—¶ï¼Œä¹Ÿè°ƒç”¨ <code>barrier.await()</code> æ¥å°†è®¡æ•°å™¨å‡1ï¼ŒåŒæ—¶ç­‰å¾…è®¡æ•°å™¨å˜æˆ0ï¼›å½“T1å’ŒT2éƒ½è°ƒç”¨ <code>barrier.await()</code> çš„æ—¶å€™ï¼Œè®¡æ•°å™¨ä¼šå‡åˆ°0ï¼Œæ­¤æ—¶T1å’ŒT2å°±å¯ä»¥æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥äº†ï¼ŒåŒæ—¶ä¼šè°ƒç”¨barrierçš„å›è°ƒå‡½æ•°æ¥æ‰§è¡Œå¯¹è´¦æ“ä½œã€‚</p><p>éå¸¸å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒCyclicBarrierçš„è®¡æ•°å™¨æœ‰è‡ªåŠ¨é‡ç½®çš„åŠŸèƒ½ï¼Œå½“å‡åˆ°0çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨é‡ç½®ä½ è®¾ç½®çš„åˆå§‹å€¼ã€‚è¿™ä¸ªåŠŸèƒ½ç”¨èµ·æ¥å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†ã€‚</p><pre><code>// è®¢å•é˜Ÿåˆ—
Vector&lt;P&gt; pos;
// æ´¾é€å•é˜Ÿåˆ—
Vector&lt;D&gt; dos;
// æ‰§è¡Œå›è°ƒçš„çº¿ç¨‹æ±  
Executor executor = 
  Executors.newFixedThreadPool(1);
final CyclicBarrier barrier =
  new CyclicBarrier(2, ()-&gt;{
    executor.execute(()-&gt;check());
  });
  
void check(){
  P p = pos.remove(0);
  D d = dos.remove(0);
  // æ‰§è¡Œå¯¹è´¦æ“ä½œ
  diff = check(p, d);
  // å·®å¼‚å†™å…¥å·®å¼‚åº“
  save(diff);
}
  
void checkAll(){
  // å¾ªç¯æŸ¥è¯¢è®¢å•åº“
  Thread T1 = new Thread(()-&gt;{
    while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
      // æŸ¥è¯¢è®¢å•åº“
      pos.add(getPOrders());
      // ç­‰å¾…
      barrier.await();
    }
  });
  T1.start();  
  // å¾ªç¯æŸ¥è¯¢è¿å•åº“
  Thread T2 = new Thread(()-&gt;{
    while(å­˜åœ¨æœªå¯¹è´¦è®¢å•){
      // æŸ¥è¯¢è¿å•åº“
      dos.add(getDOrders());
      // ç­‰å¾…
      barrier.await();
    }
  });
  T2.start();
}
</code></pre><h2>æ€»ç»“</h2><p>CountDownLatchå’ŒCyclicBarrieræ˜¯Javaå¹¶å‘åŒ…æä¾›çš„ä¸¤ä¸ªéå¸¸æ˜“ç”¨çš„çº¿ç¨‹åŒæ­¥å·¥å…·ç±»ï¼Œè¿™ä¸¤ä¸ªå·¥å…·ç±»ç”¨æ³•çš„åŒºåˆ«åœ¨è¿™é‡Œè¿˜æ˜¯æœ‰å¿…è¦å†å¼ºè°ƒä¸€ä¸‹ï¼š<strong>CountDownLatchä¸»è¦ç”¨æ¥è§£å†³ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„åœºæ™¯</strong>ï¼Œå¯ä»¥ç±»æ¯”æ—…æ¸¸å›¢å›¢é•¿è¦ç­‰å¾…æ‰€æœ‰çš„æ¸¸å®¢åˆ°é½æ‰èƒ½å»ä¸‹ä¸€ä¸ªæ™¯ç‚¹ï¼›è€Œ<strong>CyclicBarrieræ˜¯ä¸€ç»„çº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…</strong>ï¼Œæ›´åƒæ˜¯å‡ ä¸ªé©´å‹ä¹‹é—´ä¸ç¦»ä¸å¼ƒã€‚é™¤æ­¤ä¹‹å¤–CountDownLatchçš„è®¡æ•°å™¨æ˜¯ä¸èƒ½å¾ªç¯åˆ©ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è®¡æ•°å™¨å‡åˆ°0ï¼Œå†æœ‰çº¿ç¨‹è°ƒç”¨await()ï¼Œè¯¥çº¿ç¨‹ä¼šç›´æ¥é€šè¿‡ã€‚ä½†<strong>CyclicBarrierçš„è®¡æ•°å™¨æ˜¯å¯ä»¥å¾ªç¯åˆ©ç”¨çš„</strong>ï¼Œè€Œä¸”å…·å¤‡è‡ªåŠ¨é‡ç½®çš„åŠŸèƒ½ï¼Œä¸€æ—¦è®¡æ•°å™¨å‡åˆ°0ä¼šè‡ªåŠ¨é‡ç½®åˆ°ä½ è®¾ç½®çš„åˆå§‹å€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCyclicBarrierè¿˜å¯ä»¥è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå¯ä»¥è¯´æ˜¯åŠŸèƒ½ä¸°å¯Œã€‚</p><p>æœ¬ç« çš„ç¤ºä¾‹ä»£ç ä¸­æœ‰ä¸¤å¤„ç”¨åˆ°äº†çº¿ç¨‹æ± ï¼Œä½ ç°åœ¨åªéœ€è¦å¤§æ¦‚äº†è§£å³å¯ï¼Œå› ä¸ºçº¿ç¨‹æ± ç›¸å…³çš„çŸ¥è¯†å’±ä»¬ä¸“æ åé¢è¿˜ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚å¦å¤–ï¼Œçº¿ç¨‹æ± æä¾›äº†Futureç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨Futureç‰¹æ€§æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œè¿™ä¸ªåé¢æˆ‘ä»¬ä¹Ÿä¼šè¯¦ç»†ä»‹ç»ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>æœ¬ç« æœ€åçš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒCyclicBarrierçš„å›è°ƒå‡½æ•°æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œä½ è§‰å¾—æ˜¯å¦æœ‰å¿…è¦å‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><h1>çŒœä½ å–œæ¬¢</h1><p><a href="https://time.geekbang.org/course/intro/156?utm_term=zeusRVDGT&amp;utm_source=app&amp;utm_medium=javabingfabiancheng&amp;utm_campaign=156-onsell&amp;utm_content=banner0301"><img src="https://static001.geekbang.org/resource/image/8e/93/8e1906fb8a24d5eb66539fa88ea56193.png" alt="unpreview"></a></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ¢ç´¢æ— æ­¢å¢ƒ  2019-04-11 07:46:14
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä»Šå¤©çš„æ–‡ç« å¾ˆç²¾å½©ï¼Œæœ‰æ¡ˆä¾‹æœ‰é€’è¿›ï¼Œä¸€æ°”å‘µæˆï¼è®¾ç½®çº¿ç¨‹æ± ä¸ºå•ä¸ªçº¿ç¨‹å¯ä»¥ä¿è¯å¯¹è´¦çš„æ“ä½œæŒ‰é¡ºåºæ‰§è¡Œ [25èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            undifined  2019-04-11 08:40:30
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            çº¿ç¨‹æ± å¤§å°ä¸º1æ˜¯å¿…è¦çš„ï¼Œå¦‚æœè®¾ç½®ä¸ºå¤šä¸ªï¼Œæœ‰å¯èƒ½ä¼šä¸¤ä¸ªçº¿ç¨‹ A å’Œ B åŒæ—¶æŸ¥è¯¢ï¼ŒA çš„è®¢å•å…ˆè¿”å›ï¼ŒB çš„æ´¾é€å•å…ˆè¿”å›ï¼Œé€ æˆé˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸åŒ¹é…ï¼›æ‰€ä»¥1ä¸ªçº¿ç¨‹å®ç°ç”Ÿäº§æ•°æ®ä¸²è¡Œæ‰§è¡Œï¼Œä¿è¯æ•°æ®å®‰å…¨<br><br>å¦‚æœç”¨Future çš„è¯å¯ä»¥æ›´æ–¹ä¾¿ä¸€äº›ï¼š<br><br>        CompletableFuture&lt;List&gt; pOrderFuture = CompletableFuture.supplyAsync(this::getPOrders);<br>        CompletableFuture&lt;List&gt; dOrderFuture = CompletableFuture.supplyAsync(this::getDOrders);<br>        pOrderFuture.thenCombine(dOrderFuture, this::check)<br>                    .thenAccept(this::save);<br><br>è€å¸ˆè¿™æ ·ç†è§£å¯¹å—ï¼Œè°¢è°¢è€å¸ˆ<br> [10èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-11 09:15:42</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å¯¹ï¼ŒğŸ‘ğŸ‘ğŸ‘<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è¥¿è¥¿å¼—ä¸å¡å¤«å¡  2019-04-11 01:34:36
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å›è°ƒä¸­çš„çº¿ç¨‹æ± ç”¨å•çº¿ç¨‹æ˜¯ä¸ºäº†ç¡®ä¿ä»ä¸¤ä¸ªé˜Ÿåˆ—å–æ•°æ—¶å¯ä»¥ä¸€å¯¹ä¸€è·å–ï¼Œé¿å…é”™ä¹±ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ™å¯èƒ½å‡ºç°çº¿ç¨‹1è·å–PO1ï¼Œçº¿ç¨‹è·å–PO2å’ŒDO1ï¼Œçº¿ç¨‹è·å–DO2çš„ä¹±åºã€‚<br><br>å…¶å®çº¿ç¨‹æ± æ”¹æˆå¤šçº¿ç¨‹ä¹Ÿå¯ä»¥ï¼Œè¦æŠŠä¸¤ä¸ªremove(0)æ”¾åˆ°ä¸€ä¸ªåŒæ­¥å—ä¸­ [7èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ³¢æ³¢  2019-04-11 09:30:04
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ€è€ƒé¢˜ä¸­ï¼Œå¦‚æœç”Ÿäº§è€…æ¯”è¾ƒå¿«ï¼Œæ¶ˆè´¹è€…æ¯”è¾ƒæ…¢ï¼Œç”Ÿäº§è€…é€šçŸ¥çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…è¿˜åœ¨å¯¹è´¦ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿä¼šä¸ä¼šå¯¼è‡´æ¶ˆè´¹è€…é”™å¤±é€šçŸ¥ï¼Œå¯¼è‡´é˜Ÿåˆ—æ»¡äº†ï¼Œä½†æ˜¯æ¶ˆè´¹è€…å´æ²¡æœ‰æ”¶åˆ°é€šçŸ¥ã€‚ [5èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-12 19:17:45</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æœ‰è¿™ç§å¯èƒ½ï¼Œè¿˜èƒ½oom<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            nanquanmama  2019-04-11 08:32:55
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ€åçš„é‚£ä¸ªä¾‹å­ï¼Œä¸šåŠ¡é€»è¾‘çš„éƒ¨åˆ†å·²ç»å˜å¾—å¾ˆä¸ç›´è§‚ï¼Œå¹¶å‘æ§åˆ¶çš„é€»è¾‘æ©ç›–ä½äº†ä¸šåŠ¡é€»è¾‘ã€‚è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œå®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¹¶å‘æ§åˆ¶é€»è¾‘å¦‚ä½•åšï¼Œæ‰èƒ½å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥ï¼Ÿ [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-11 09:22:52</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ”¾åˆ°ä¸åŒçš„ç±»é‡Œï¼Œè¿™æ–¹é¢ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡å¯ä»¥è§£å†³ï¼Œlambdaä¹Ÿèƒ½è§£å†³ï¼Œè¿™ä¸ªæ¨¡å—çš„æœ€åå‡ ç« èƒ½è§£å†³ä½ è¯´çš„è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ›´å¤æ‚çš„åœºæ™¯è¿˜å¾—è‡ªå·±è®¾è®¡<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Darren  2019-04-11 00:35:42
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€Œä¸”å…¶å®å¯ä»¥ç›´æ¥singleçº¿ç¨‹æ± çš„ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦Executorsæä¾›çš„çº¿ç¨‹æ± ï¼Œéƒ½æœ‰å¼Šç«¯ï¼Œæœ€å¥½è‡ªå®šä¹‰çº¿ç¨‹æ±  [3èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-12 19:21:03</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Darren  2019-04-11 00:29:44
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰ä¸€å®šçš„å¿…è¦ï¼Œå› ä¸ºCyclicBarrieræ˜¯å¯ä»¥é‡åˆ¶çš„ï¼Œæ‰€ä»¥å¦‚æœä¸ç”¨çº¿ç¨‹æ± çš„è¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ–°å»ºçº¿ç¨‹ï¼Œæµªè´¹èµ„æºã€‚ä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œè¯·å¤§ä½¬æŒ‡ç‚¹ [3èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ... ...  2019-04-12 17:30:18
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è¿½é—®ï¼šå¦‚æœçº¿ç¨‹æ± æ˜¯å•çº¿ç¨‹çš„è¯ã€‚é‚£å‡å¦‚ç”Ÿäº§è€…é€Ÿåº¦å¿«è¿checkå‡½æ•°æ‰§è¡Œæ—¶é—´ã€‚é‚£æ˜¯ä¸æ˜¯å°±ä¼šå‡ºç°å µå¡æƒ…å†µäº†ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œæ˜¯ä¸æ˜¯ä¼šå‡ºç°é˜Ÿåˆ—å†…å­˜æº¢å‡º [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-12 18:36:43</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä¼š<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è¥¿å…¹å…¹  2019-04-11 22:53:02
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            undefindåŒå­¦çš„æ„æ€å·®ä¸å¤šå¯¹ã€‚                         åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ˜¯å› ä¸ºï¼Œè®¢å•é˜Ÿåˆ—å’Œæ´¾å•é˜Ÿåˆ—è¯»å–æ•°æ®å­˜åœ¨ç«æ€æ¡ä»¶ã€‚ å¦‚æœè¦å¼€å¤šä¸ªçº¿ç¨‹ï¼Œåˆ™éœ€è¦ä¸€ä¸ªlockè¿›è¡ŒåŒæ­¥é‚£ä¸¤ä¸ªremoveæ–¹æ³•ã€‚    ä¸ªäººæ¨èçš„æ€è·¯æ˜¯ï¼Œå¦‚æœç”Ÿäº§è€…é€Ÿåº¦æ¯”æ¶ˆè´¹è€…å¿«çš„æƒ…å†µä¸‹ï¼Œæ”¾å…¥ä¸€ä¸ªåŒå‘çš„é˜»å¡é˜Ÿåˆ—å°¾éƒ¨ï¼Œæ¯æ¬¡ä»åŒå‘é˜Ÿåˆ—å¤´éƒ¨å–ä¸¤ä¸ªå¯¹è±¡ï¼Œæ ¹æ®å¯¹è±¡å±æ€§æ¥åŒºåˆ«è®¢å•ç±»å‹ï¼Œä¹Ÿèƒ½å¼€å¤šä¸ªçº¿ç¨‹è¿›è¡Œcheckæ“ä½œã€‚  ä½†æœ¬æ–‡ä¸šåŠ¡é‡Œchecké€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥è¿™ä¸ªåœºæ™¯åªéœ€è¦å¼€1ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± æ˜¯åˆç†çš„ã€‚ [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-12 00:09:46</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä¸€æ¬¡å¤šå–å‡ ä¸ªç„¶åæ‰¹é‡æ‰§è¡Œï¼Œè¿™ä¸ªåŠæ³•éå¸¸å®ç”¨ï¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æœ¨å¶äººKing  2019-04-11 17:31:27
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œæœ€åcheckAllï¼ˆï¼‰ è¿™é‡Œä¸ºä»€ä¹ˆnew äº†ä¸¤ä¸ªThread  è€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± <br><br><br> [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-11 19:57:41</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">åæ­£ä¹Ÿä¸ä¼šåå¤åˆ›å»ºï¼Œç”¨ä¸ç”¨éƒ½æ²¡å…³ç³»<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç©ºçŸ¥  2019-04-11 14:55:47
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆ,å…³äºCyclicBarrierå›è°ƒå‡½æ•°,è¯·æ•™ä¸‹<br>è‡ªå·±å†™äº†ä¸ª CyclicBarrierçš„ä¾‹å­,å›è°ƒå‡½æ•°æ€»æ˜¯åœ¨è®¡æ•°å™¨å½’0æ—¶å€™æ‰§è¡Œ,ä½†æ˜¯çº¿ç¨‹T1 T2è¦ç­‰å›è°ƒå‡½æ•°æ‰§è¡Œç»“æŸä¹‹åæ‰ä¼šå†æ¬¡æ‰§è¡Œ...çœ‹äº†ä¸‹CyclicBarrier çš„æºç ,å½“å†…éƒ¨è®¡æ•°å™¨ index == 0æ—¶å€™, <br><br>final Runnable command = barrierCommand;<br>                    <br>if (command != null)<br>                        <br>	command.run();<br>æ²¡æœ‰å¼€å¯å­çº¿ç¨‹å§.ä¹Ÿå°±æ˜¯è¯´ å¯¹è´¦è¿˜æ˜¯åŒæ­¥æ‰§è¡Œçš„,ç»“æŸä¹‹åæ‰æ˜¯ä¸‹ä¸€æ¬¡çš„æŸ¥è¯¢ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-11 20:07:39</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ‰€ä»¥æ‰éœ€è¦çº¿ç¨‹æ± æ¥å¼‚æ­¥æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä½ ä¸€ä¸å°å¿ƒæŠŠç­”æ¡ˆæ‰¾åˆ°äº†ğŸ˜‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç»´æ–¯æœ‰æ¡æ²³  2019-04-11 13:24:39
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ„Ÿè°¢è€å¸ˆï¼Œä¸€ç›´ä¸å¤ªæ˜ç™½ä»€ä¹ˆæ—¶å€™ç”¨CyclicBarrierï¼Œä»Šå¤©çœ‹åˆ°æ¡ˆä¾‹äº†ï¼Œåˆšçœ‹åˆ°joiné‚£æ®µæˆ‘æƒ³åˆ°äº†CompletableFuture<br><br> [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-11 20:08:59</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            iron_man  2019-04-11 11:39:24
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ç‹è€å¸ˆï¼Œcyclicbarrierï¼Œå…·ä½“æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™æ¸…é›¶è®¡æ•°å™¨å‘¢ï¼Ÿæ˜¯åœ¨æ‰€æœ‰çº¿ç¨‹awaitè¿”å›åè¿˜æ˜¯åœ¨å›è°ƒå‡½æ•°è°ƒç”¨åï¼Ÿawaitå’Œå›æ‰å‡½æ•°çš„è°ƒç”¨é¡ºåºæ˜¯æ€æ ·çš„ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-14 19:34:35</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å›è°ƒå‡½æ•°æ‰§è¡Œå®Œä¹‹åæ‰ä¼šå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            magict4  2019-04-11 05:51:29
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            &gt; å¦å¤–ï¼Œçº¿ç¨‹æ± æä¾›äº† Future ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ Fu...<br><br>æŒºæœŸå¾…è€å¸ˆå¯ä»¥è®²è®²ä»€ä¹ˆæ—¶å€™ç”¨ Future.get()ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ CountDownLatch æ¥ç­‰å¾…çº¿ç¨‹å®Œæˆã€‚ [1èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç¢³æ°´åŒ–åˆç‰©  2019-04-17 02:28:04
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å¦‚æœæœ€åçš„çº¿ç¨‹æ± æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿè€å¸ˆèƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿæƒ³äº†å¥½ä¹…æ²¡æƒ³å‡ºæ¥å•Šï¼Œæœ‰ç‚¹æŠ˜ç£¨äºº 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Zach_  2019-04-15 09:16:37
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ—¥å¸¸æ‰“å¡ï¼ŒæœŸå¾…è€å¸ˆåç»­æ›´ç²¾å½©çš„è®²è§£ï¼ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å°ç¾  2019-04-14 23:11:11
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸ºä»€ä¹ˆcycliyBarrier ä¸­ä¸ç”¨å¤§å°ä¸º3çš„çº¿ç¨‹æ±  
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-15 10:31:14</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">é‚£æˆ‘å¾—å…ˆè®²çº¿ç¨‹æ± </div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å§œå°ç™½  2019-04-14 20:37:09
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œä½ çš„æœ€åä¸€ä¸ªä¾‹å­ä»£ç ä¸­ï¼ŒT1.start()ä¹‹å‰ï¼Œå¯¹äºT1çš„å®šä¹‰ï¼Œæ˜¯ä¸æ˜¯å°‘äº†ä¸€ä¸ª&quot;<br>)&quot;ï¼Œè¿˜æœ‰T2ä¹Ÿæ˜¯ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-14 21:16:11</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ç«ç„°é‡‘ç²¾ï¼ï¼ï¼å¤šè°¢å¤šè°¢ï¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ©˜å­ä¸é…¸  2019-04-14 11:43:05
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œbarrierçš„ barrierActionæ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªçº¿ç¨‹è¿›å…¥åå°±ä¼šæ‰§è¡Œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ä¹‹å‰è¿›å…¥çš„çº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œçš„è¯ï¼Œåœ¨è¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹ï¼Œå¯¹è´¦æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-14 19:19:41</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">barrierActionæ˜¯åŒæ­¥æ‰§è¡Œï¼Œåªæœ‰æ‰§è¡Œå®Œæ‰ä¼šå¼€å¯ä¸‹ä¸€è½®ã€‚ æ‰€ä»¥ç”¨ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ—¢èƒ½è§£å†³åŒæ­¥çš„æ€§èƒ½é—®é¢˜ï¼Œä¹Ÿèƒ½è§£å†³æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ›¾è½¼éºŸ  2019-04-13 21:52:19
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆæ¨èæ‚¨ä½¿ç”¨ThreadPoolExecutorå»å®ç°çº¿ç¨‹æ± ï¼Œå¹¶ä¸”å®ç°é‡Œé¢çš„RejectedExecutionHandlerå’ŒThreadFactoryï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿å½“è°ƒç”¨è®¢å•æŸ¥è¯¢å’Œæ´¾é€å•æŸ¥è¯¢çš„æ—¶å€™å‡ºç°full gcçš„æ—¶å€™ dumpæ–‡ä»¶ å¯ä»¥å¿«é€Ÿå®šä½å‡ºç°é—®é¢˜çš„çº¿ç¨‹æ˜¯å“ªä¸ªä¸šåŠ¡çº¿ç¨‹ï¼Œå¦‚æœæ˜¯CountDownLatchï¼Œå»ºè®®è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…ç”±äºä¸šåŠ¡æ­»é”æ²¡æœ‰è°ƒç”¨countDown()å¯¼è‡´ç°çº¿ç¨‹ç¡æ­»çš„æƒ…å†µ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-13 23:32:06</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å¥½å»ºè®®ï¼Œæ‰€æœ‰çš„é˜»å¡æ“ä½œï¼Œéƒ½éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¿™æ˜¯ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ã€‚</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>