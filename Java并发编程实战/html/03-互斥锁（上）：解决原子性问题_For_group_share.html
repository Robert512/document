<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>03-äº’æ–¥é”ï¼ˆä¸Šï¼‰ï¼šè§£å†³åŸå­æ€§é—®é¢˜</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>03-äº’æ–¥é”ï¼ˆä¸Šï¼‰ï¼šè§£å†³åŸå­æ€§é—®é¢˜</h1>
<p>åœ¨<a href="https://time.geekbang.org/column/article/83682">ç¬¬ä¸€ç¯‡æ–‡ç« </a>ä¸­æˆ‘ä»¬æåˆ°ï¼Œä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåœ¨CPUæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸è¢«ä¸­æ–­çš„ç‰¹æ€§ï¼Œç§°ä¸ºâ€œåŸå­æ€§â€ã€‚ç†è§£è¿™ä¸ªç‰¹æ€§æœ‰åŠ©äºä½ åˆ†æå¹¶å‘ç¼–ç¨‹Bugå‡ºç°çš„åŸå› ï¼Œä¾‹å¦‚åˆ©ç”¨å®ƒå¯ä»¥åˆ†æå‡ºlongå‹å˜é‡åœ¨32ä½æœºå™¨ä¸Šè¯»å†™å¯èƒ½å‡ºç°çš„è¯¡å¼‚Bugï¼Œæ˜æ˜å·²ç»æŠŠå˜é‡æˆåŠŸå†™å…¥å†…å­˜ï¼Œé‡æ–°è¯»å‡ºæ¥å´ä¸æ˜¯è‡ªå·±å†™å…¥çš„ã€‚</p><p><strong>é‚£åŸå­æ€§é—®é¢˜åˆ°åº•è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</strong></p><p>ä½ å·²ç»çŸ¥é“ï¼ŒåŸå­æ€§é—®é¢˜çš„æºå¤´æ˜¯<strong>çº¿ç¨‹åˆ‡æ¢</strong>ï¼Œå¦‚æœèƒ½å¤Ÿç¦ç”¨çº¿ç¨‹åˆ‡æ¢é‚£ä¸å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†å—ï¼Ÿè€Œæ“ä½œç³»ç»Ÿåšçº¿ç¨‹åˆ‡æ¢æ˜¯ä¾èµ–CPUä¸­æ–­çš„ï¼Œæ‰€ä»¥ç¦æ­¢CPUå‘ç”Ÿä¸­æ–­å°±èƒ½å¤Ÿç¦æ­¢çº¿ç¨‹åˆ‡æ¢ã€‚</p><p>åœ¨æ—©æœŸå•æ ¸CPUæ—¶ä»£ï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„ç¡®æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”ä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨æ¡ˆä¾‹ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆå¤šæ ¸åœºæ™¯ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥32ä½CPUä¸Šæ‰§è¡Œlongå‹å˜é‡çš„å†™æ“ä½œä¸ºä¾‹æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œlongå‹å˜é‡æ˜¯64ä½ï¼Œåœ¨32ä½CPUä¸Šæ‰§è¡Œå†™æ“ä½œä¼šè¢«æ‹†åˆ†æˆä¸¤æ¬¡å†™æ“ä½œï¼ˆå†™é«˜32ä½å’Œå†™ä½32ä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/38/28/381b657801c48b3399f19d946bad9e28.png" alt=""></p><p>åœ¨å•æ ¸CPUåœºæ™¯ä¸‹ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œç¦æ­¢CPUä¸­æ–­ï¼Œæ„å‘³ç€æ“ä½œç³»ç»Ÿä¸ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¦æ­¢äº†çº¿ç¨‹åˆ‡æ¢ï¼Œè·å¾—CPUä½¿ç”¨æƒçš„çº¿ç¨‹å°±å¯ä»¥ä¸é—´æ–­åœ°æ‰§è¡Œï¼Œæ‰€ä»¥ä¸¤æ¬¡å†™æ“ä½œä¸€å®šæ˜¯ï¼šè¦ä¹ˆéƒ½è¢«æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰è¢«æ‰§è¡Œï¼Œå…·æœ‰åŸå­æ€§ã€‚</p><p>ä½†æ˜¯åœ¨å¤šæ ¸åœºæ™¯ä¸‹ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œæœ‰å¯èƒ½æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ‰§è¡Œï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåœ¨CPU-1ä¸Šï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåœ¨CPU-2ä¸Šï¼Œæ­¤æ—¶ç¦æ­¢CPUä¸­æ–­ï¼Œåªèƒ½ä¿è¯CPUä¸Šçš„çº¿ç¨‹è¿ç»­æ‰§è¡Œï¼Œå¹¶ä¸èƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æœè¿™ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å†™longå‹å˜é‡é«˜32ä½çš„è¯ï¼Œé‚£å°±æœ‰å¯èƒ½å‡ºç°æˆ‘ä»¬å¼€å¤´æåŠçš„è¯¡å¼‚Bugäº†ã€‚</p><!-- [[[read_end]]] --><p>â€œ<strong>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</strong>â€è¿™ä¸ªæ¡ä»¶éå¸¸é‡è¦ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>äº’æ–¥</strong>ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¿è¯å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹æ˜¯äº’æ–¥çš„ï¼Œé‚£ä¹ˆï¼Œæ— è®ºæ˜¯å•æ ¸CPUè¿˜æ˜¯å¤šæ ¸CPUï¼Œå°±éƒ½èƒ½ä¿è¯åŸå­æ€§äº†ã€‚</p><h2>ç®€æ˜“é”æ¨¡å‹</h2><p>å½“è°ˆåˆ°äº’æ–¥ï¼Œç›¸ä¿¡èªæ˜çš„ä½ ä¸€å®šæƒ³åˆ°äº†é‚£ä¸ªæ€æ‰‹çº§è§£å†³æ–¹æ¡ˆï¼šé”ã€‚åŒæ—¶å¤§è„‘ä¸­è¿˜ä¼šå‡ºç°ä»¥ä¸‹æ¨¡å‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/3d/a2/3df991e7de14a788b220468836cd48a2.png" alt=""></p><center><span class="reference">ç®€æ˜“é”æ¨¡å‹</span></center><p>æˆ‘ä»¬æŠŠä¸€æ®µéœ€è¦äº’æ–¥æ‰§è¡Œçš„ä»£ç ç§°ä¸º<strong>ä¸´ç•ŒåŒº</strong>ã€‚çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œé¦–å…ˆå°è¯•åŠ é”lock()ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºï¼Œæ­¤æ—¶æˆ‘ä»¬ç§°è¿™ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼›å¦åˆ™å‘¢å°±ç­‰å¾…ï¼Œç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹è§£é”ï¼›æŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œå®Œä¸´ç•ŒåŒºçš„ä»£ç åï¼Œæ‰§è¡Œè§£é”unlock()ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹éå¸¸åƒåŠå…¬å®¤é‡Œé«˜å³°æœŸæŠ¢å å‘ä½ï¼Œæ¯ä¸ªäººéƒ½æ˜¯è¿›å‘é”é—¨ï¼ˆåŠ é”ï¼‰ï¼Œå‡ºå‘å¼€é—¨ï¼ˆè§£é”ï¼‰ï¼Œå¦‚å•è¿™ä¸ªäº‹å°±æ˜¯ä¸´ç•ŒåŒºã€‚å¾ˆé•¿æ—¶é—´é‡Œï¼Œæˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆç†è§£çš„ã€‚è¿™æ ·ç†è§£æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†å´å¾ˆå®¹æ˜“è®©æˆ‘ä»¬å¿½è§†ä¸¤ä¸ªéå¸¸éå¸¸é‡è¦çš„ç‚¹ï¼šæˆ‘ä»¬é”çš„æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¿æŠ¤çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><h2>æ”¹è¿›åçš„é”æ¨¡å‹</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨ç°å®ä¸–ç•Œé‡Œï¼Œé”å’Œé”è¦ä¿æŠ¤çš„èµ„æºæ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œæ¯”å¦‚ä½ ç”¨ä½ å®¶çš„é”ä¿æŠ¤ä½ å®¶çš„ä¸œè¥¿ï¼Œæˆ‘ç”¨æˆ‘å®¶çš„é”ä¿æŠ¤æˆ‘å®¶çš„ä¸œè¥¿ã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œé”å’Œèµ„æºä¹Ÿåº”è¯¥æœ‰è¿™ä¸ªå…³ç³»ï¼Œä½†è¿™ä¸ªå…³ç³»åœ¨æˆ‘ä»¬ä¸Šé¢çš„æ¨¡å‹ä¸­æ˜¯æ²¡æœ‰ä½“ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®Œå–„ä¸€ä¸‹æˆ‘ä»¬çš„æ¨¡å‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/28/2f/287008c8137a43fa032e68a0c23c172f.png" alt=""></p><center><span class="reference">æ”¹è¿›åçš„é”æ¨¡å‹</span></center><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æŠŠä¸´ç•ŒåŒºè¦ä¿æŠ¤çš„èµ„æºæ ‡æ³¨å‡ºæ¥ï¼Œå¦‚å›¾ä¸­ä¸´ç•ŒåŒºé‡Œå¢åŠ äº†ä¸€ä¸ªå…ƒç´ ï¼šå—ä¿æŠ¤çš„èµ„æºRï¼›å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦ä¿æŠ¤èµ„æºRå°±å¾—ä¸ºå®ƒåˆ›å»ºä¸€æŠŠé”LRï¼›æœ€åï¼Œé’ˆå¯¹è¿™æŠŠé”LRï¼Œæˆ‘ä»¬è¿˜éœ€åœ¨è¿›å‡ºä¸´ç•ŒåŒºæ—¶æ·»ä¸ŠåŠ é”æ“ä½œå’Œè§£é”æ“ä½œã€‚å¦å¤–ï¼Œåœ¨é”LRå’Œå—ä¿æŠ¤èµ„æºä¹‹é—´ï¼Œæˆ‘ç‰¹åœ°ç”¨ä¸€æ¡çº¿åšäº†å…³è”ï¼Œè¿™ä¸ªå…³è”å…³ç³»éå¸¸é‡è¦ã€‚å¾ˆå¤šå¹¶å‘Bugçš„å‡ºç°éƒ½æ˜¯å› ä¸ºæŠŠå®ƒå¿½ç•¥äº†ï¼Œç„¶åå°±å‡ºç°äº†ç±»ä¼¼é”è‡ªå®¶é—¨æ¥ä¿æŠ¤ä»–å®¶èµ„äº§çš„äº‹æƒ…ï¼Œè¿™æ ·çš„Bugéå¸¸ä¸å¥½è¯Šæ–­ï¼Œå› ä¸ºæ½œæ„è¯†é‡Œæˆ‘ä»¬è®¤ä¸ºå·²ç»æ­£ç¡®åŠ é”äº†ã€‚</p><h2>Javaè¯­è¨€æä¾›çš„é”æŠ€æœ¯ï¼šsynchronized</h2><p>é”æ˜¯ä¸€ç§é€šç”¨çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒJavaè¯­è¨€æä¾›çš„synchronizedå…³é”®å­—ï¼Œå°±æ˜¯é”çš„ä¸€ç§å®ç°ã€‚synchronizedå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°ä»£ç å—ï¼Œå®ƒçš„ä½¿ç”¨ç¤ºä¾‹åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code>class X {
  // ä¿®é¥°éé™æ€æ–¹æ³•
  synchronized void foo() {
    // ä¸´ç•ŒåŒº
  }
  // ä¿®é¥°é™æ€æ–¹æ³•
  synchronized static void bar() {
    // ä¸´ç•ŒåŒº
  }
  // ä¿®é¥°ä»£ç å—
  Object obj = new Object()ï¼›
  void baz() {
    synchronized(obj) {
      // ä¸´ç•ŒåŒº
    }
  }
}  
</code></pre><p>çœ‹å®Œä¹‹åä½ å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„æ¨¡å‹æœ‰ç‚¹å¯¹ä¸ä¸Šå·å•Šï¼ŒåŠ é”lock()å’Œè§£é”unlock()åœ¨å“ªé‡Œå‘¢ï¼Ÿå…¶å®è¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯æœ‰çš„ï¼Œåªæ˜¯è¿™ä¸¤ä¸ªæ“ä½œæ˜¯è¢«Javaé»˜é»˜åŠ ä¸Šçš„ï¼ŒJavaç¼–è¯‘å™¨ä¼šåœ¨synchronizedä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—å‰åè‡ªåŠ¨åŠ ä¸ŠåŠ é”lock()å’Œè§£é”unlock()ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯åŠ é”lock()å’Œè§£é”unlock()ä¸€å®šæ˜¯æˆå¯¹å‡ºç°çš„ï¼Œæ¯•ç«Ÿå¿˜è®°è§£é”unlock()å¯æ˜¯ä¸ªè‡´å‘½çš„Bugï¼ˆæ„å‘³ç€å…¶ä»–çº¿ç¨‹åªèƒ½æ­»ç­‰ä¸‹å»äº†ï¼‰ã€‚</p><p>é‚£synchronizedé‡Œçš„åŠ é”lock()å’Œè§£é”unlock()é”å®šçš„å¯¹è±¡åœ¨å“ªé‡Œå‘¢ï¼Ÿä¸Šé¢çš„ä»£ç æˆ‘ä»¬çœ‹åˆ°åªæœ‰ä¿®é¥°ä»£ç å—çš„æ—¶å€™ï¼Œé”å®šäº†ä¸€ä¸ªobjå¯¹è±¡ï¼Œé‚£ä¿®é¥°æ–¹æ³•çš„æ—¶å€™é”å®šçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªä¹Ÿæ˜¯Javaçš„ä¸€æ¡éšå¼è§„åˆ™ï¼š</p><blockquote>
<p>å½“ä¿®é¥°é™æ€æ–¹æ³•çš„æ—¶å€™ï¼Œé”å®šçš„æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯Class Xï¼›<br>
å½“ä¿®é¥°éé™æ€æ–¹æ³•çš„æ—¶å€™ï¼Œé”å®šçš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡thisã€‚</p>
</blockquote><p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œsynchronizedä¿®é¥°é™æ€æ–¹æ³•ç›¸å½“äº:</p><pre><code>class X {
  // ä¿®é¥°é™æ€æ–¹æ³•
  synchronized(X.class) static void bar() {
    // ä¸´ç•ŒåŒº
  }
}
</code></pre><p>ä¿®é¥°éé™æ€æ–¹æ³•ï¼Œç›¸å½“äºï¼š</p><pre><code>class X {
  // ä¿®é¥°éé™æ€æ–¹æ³•
  synchronized(this) void foo() {
    // ä¸´ç•ŒåŒº
  }
}
</code></pre><h2>ç”¨synchronizedè§£å†³count+=1é—®é¢˜</h2><p>ç›¸ä¿¡ä½ ä¸€å®šè®°å¾—æˆ‘ä»¬å‰é¢æ–‡ç« ä¸­æåˆ°è¿‡çš„count+=1å­˜åœ¨çš„å¹¶å‘é—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨synchronizedæ¥å°è¯•ç‰›åˆ€ä¸€æŠŠï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚SafeCalcè¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šä¸€ä¸ªæ˜¯get()æ–¹æ³•ï¼Œç”¨æ¥è·å¾—valueçš„å€¼ï¼›å¦ä¸€ä¸ªæ˜¯addOne()æ–¹æ³•ï¼Œç”¨æ¥ç»™valueåŠ 1ï¼Œå¹¶ä¸”addOne()æ–¹æ³•æˆ‘ä»¬ç”¨synchronizedä¿®é¥°ã€‚é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰å¹¶å‘é—®é¢˜å‘¢ï¼Ÿ</p><pre><code>class SafeCalc {
  long value = 0L;
  long get() {
    return value;
  }
  synchronized void addOne() {
    value += 1;
  }
}
</code></pre><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹addOne()æ–¹æ³•ï¼Œé¦–å…ˆå¯ä»¥è‚¯å®šï¼Œè¢«synchronizedä¿®é¥°åï¼Œæ— è®ºæ˜¯å•æ ¸CPUè¿˜æ˜¯å¤šæ ¸CPUï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒaddOne()æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€å®šèƒ½ä¿è¯åŸå­æ“ä½œï¼Œé‚£æ˜¯å¦æœ‰å¯è§æ€§é—®é¢˜å‘¢ï¼Ÿè¦å›ç­”è¿™é—®é¢˜ï¼Œå°±è¦é‡æ¸©ä¸€ä¸‹<a href="https://time.geekbang.org/column/article/84017">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­æåˆ°çš„<strong>ç®¡ç¨‹ä¸­é”çš„è§„åˆ™</strong>ã€‚</p><blockquote>
<p>ç®¡ç¨‹ä¸­é”çš„è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</p>
</blockquote><p>ç®¡ç¨‹ï¼Œå°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„synchronizedï¼ˆè‡³äºä¸ºä»€ä¹ˆå«ç®¡ç¨‹ï¼Œæˆ‘ä»¬åé¢ä»‹ç»ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“synchronizedä¿®é¥°çš„ä¸´ç•ŒåŒºæ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ï¼›è€Œæ‰€è°“â€œå¯¹ä¸€ä¸ªé”è§£é”  Happens-Before åç»­å¯¹è¿™ä¸ªé”çš„åŠ é”â€ï¼ŒæŒ‡çš„æ˜¯å‰ä¸€ä¸ªçº¿ç¨‹çš„è§£é”æ“ä½œå¯¹åä¸€ä¸ªçº¿ç¨‹çš„åŠ é”æ“ä½œå¯è§ï¼Œç»¼åˆHappens-Beforeçš„ä¼ é€’æ€§åŸåˆ™ï¼Œæˆ‘ä»¬å°±èƒ½å¾—å‡ºå‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºä¿®æ”¹çš„å…±äº«å˜é‡ï¼ˆè¯¥æ“ä½œåœ¨è§£é”ä¹‹å‰ï¼‰ï¼Œå¯¹åç»­è¿›å…¥ä¸´ç•ŒåŒºï¼ˆè¯¥æ“ä½œåœ¨åŠ é”ä¹‹åï¼‰çš„çº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p><p>æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒaddOne()æ–¹æ³•ï¼Œå¯è§æ€§æ˜¯å¯ä»¥ä¿è¯çš„ï¼Œä¹Ÿå°±è¯´å¦‚æœæœ‰1000ä¸ªçº¿ç¨‹æ‰§è¡ŒaddOne()æ–¹æ³•ï¼Œæœ€ç»ˆç»“æœä¸€å®šæ˜¯valueçš„å€¼å¢åŠ äº†1000ã€‚çœ‹åˆ°è¿™ä¸ªç»“æœï¼Œæˆ‘ä»¬é•¿å‡ºä¸€å£æ°”ï¼Œé—®é¢˜ç»ˆäºè§£å†³äº†ã€‚</p><p>ä½†ä¹Ÿè®¸ï¼Œä½ ä¸€ä¸å°å¿ƒå°±å¿½è§†äº†get()æ–¹æ³•ã€‚æ‰§è¡ŒaddOne()æ–¹æ³•åï¼Œvalueçš„å€¼å¯¹get()æ–¹æ³•æ˜¯å¯è§çš„å—ï¼Ÿè¿™ä¸ªå¯è§æ€§æ˜¯æ²¡æ³•ä¿è¯çš„ã€‚ç®¡ç¨‹ä¸­é”çš„è§„åˆ™ï¼Œæ˜¯åªä¿è¯åç»­å¯¹è¿™ä¸ªé”çš„åŠ é”çš„å¯è§æ€§ï¼Œè€Œget()æ–¹æ³•å¹¶æ²¡æœ‰åŠ é”æ“ä½œï¼Œæ‰€ä»¥å¯è§æ€§æ²¡æ³•ä¿è¯ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯get()æ–¹æ³•ä¹Ÿsynchronizedä¸€ä¸‹ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>class SafeCalc {
  long value = 0L;
  synchronized long get() {
    return value;
  }
  synchronized void addOne() {
    value += 1;
  }
}
</code></pre><p>ä¸Šé¢çš„ä»£ç è½¬æ¢ä¸ºæˆ‘ä»¬æåˆ°çš„é”æ¨¡å‹ï¼Œå°±æ˜¯ä¸‹é¢å›¾ç¤ºè¿™ä¸ªæ ·å­ã€‚get()æ–¹æ³•å’ŒaddOne()æ–¹æ³•éƒ½éœ€è¦è®¿é—®valueè¿™ä¸ªå—ä¿æŠ¤çš„èµ„æºï¼Œè¿™ä¸ªèµ„æºç”¨thisè¿™æŠŠé”æ¥ä¿æŠ¤ã€‚çº¿ç¨‹è¦è¿›å…¥ä¸´ç•ŒåŒºget()å’ŒaddOne()ï¼Œå¿…é¡»å…ˆè·å¾—thisè¿™æŠŠé”ï¼Œè¿™æ ·get()å’ŒaddOne()ä¹Ÿæ˜¯äº’æ–¥çš„ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/26/f6/26a84ffe2b4a6ae67c8093d29473e1f6.png" alt=""></p><center><span class="reference">ä¿æŠ¤ä¸´ç•ŒåŒºget()å’ŒaddOne()çš„ç¤ºæ„å›¾</span></center><p>è¿™ä¸ªæ¨¡å‹æ›´åƒç°å®ä¸–ç•Œé‡Œé¢çƒèµ›é—¨ç¥¨çš„ç®¡ç†ï¼Œä¸€ä¸ªåº§ä½åªå…è®¸ä¸€ä¸ªäººä½¿ç”¨ï¼Œè¿™ä¸ªåº§ä½å°±æ˜¯â€œå—ä¿æŠ¤èµ„æºâ€ï¼Œçƒåœºçš„å…¥å£å°±æ˜¯Javaç±»é‡Œçš„æ–¹æ³•ï¼Œè€Œé—¨ç¥¨å°±æ˜¯ç”¨æ¥ä¿æŠ¤èµ„æºçš„â€œé”â€ï¼ŒJavaé‡Œçš„æ£€ç¥¨å·¥ä½œæ˜¯ç”±synchronizedè§£å†³çš„ã€‚</p><h2>é”å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³»</h2><p>æˆ‘ä»¬å‰é¢æåˆ°ï¼Œå—ä¿æŠ¤èµ„æºå’Œé”ä¹‹é—´çš„å…³è”å…³ç³»éå¸¸é‡è¦ï¼Œä»–ä»¬çš„å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿä¸€ä¸ªåˆç†çš„å…³ç³»æ˜¯ï¼š<strong>å—ä¿æŠ¤èµ„æºå’Œé”ä¹‹é—´çš„å…³è”å…³ç³»æ˜¯N:1çš„å…³ç³»</strong>ã€‚è¿˜æ‹¿å‰é¢çƒèµ›é—¨ç¥¨çš„ç®¡ç†æ¥ç±»æ¯”ï¼Œå°±æ˜¯ä¸€ä¸ªåº§ä½ï¼Œæˆ‘ä»¬åªèƒ½ç”¨ä¸€å¼ ç¥¨æ¥ä¿æŠ¤ï¼Œå¦‚æœå¤šå‘äº†é‡å¤çš„ç¥¨ï¼Œé‚£å°±è¦æ‰“æ¶äº†ã€‚ç°å®ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šæŠŠé”æ¥ä¿æŠ¤åŒä¸€ä¸ªèµ„æºï¼Œä½†åœ¨å¹¶å‘é¢†åŸŸæ˜¯ä¸è¡Œçš„ï¼Œå¹¶å‘é¢†åŸŸçš„é”å’Œç°å®ä¸–ç•Œçš„é”ä¸æ˜¯å®Œå…¨åŒ¹é…çš„ã€‚ä¸è¿‡å€’æ˜¯å¯ä»¥ç”¨åŒä¸€æŠŠé”æ¥ä¿æŠ¤å¤šä¸ªèµ„æºï¼Œè¿™ä¸ªå¯¹åº”åˆ°ç°å®ä¸–ç•Œå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œåŒ…åœºâ€äº†ã€‚</p><p>ä¸Šé¢é‚£ä¸ªä¾‹å­æˆ‘ç¨ä½œæ”¹åŠ¨ï¼ŒæŠŠvalueæ”¹æˆé™æ€å˜é‡ï¼ŒæŠŠaddOne()æ–¹æ³•æ”¹æˆé™æ€æ–¹æ³•ï¼Œæ­¤æ—¶get()æ–¹æ³•å’ŒaddOne()æ–¹æ³•æ˜¯å¦å­˜åœ¨å¹¶å‘é—®é¢˜å‘¢ï¼Ÿ</p><pre><code>class SafeCalc {
  static long value = 0L;
  synchronized long get() {
    return value;
  }
  synchronized static void addOne() {
    value += 1;
  }
}
</code></pre><p>å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œå°±ä¼šå‘ç°æ”¹åŠ¨åçš„ä»£ç æ˜¯ç”¨ä¸¤ä¸ªé”ä¿æŠ¤ä¸€ä¸ªèµ„æºã€‚è¿™ä¸ªå—ä¿æŠ¤çš„èµ„æºå°±æ˜¯é™æ€å˜é‡valueï¼Œä¸¤ä¸ªé”åˆ†åˆ«æ˜¯thiså’ŒSafeCalc.classã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™å¹…å›¾æ¥å½¢è±¡æè¿°è¿™ä¸ªå…³ç³»ã€‚ç”±äºä¸´ç•ŒåŒºget()å’ŒaddOne()æ˜¯ç”¨ä¸¤ä¸ªé”ä¿æŠ¤çš„ï¼Œå› æ­¤è¿™ä¸¤ä¸ªä¸´ç•ŒåŒºæ²¡æœ‰äº’æ–¥å…³ç³»ï¼Œä¸´ç•ŒåŒºaddOne()å¯¹valueçš„ä¿®æ”¹å¯¹ä¸´ç•ŒåŒºget()ä¹Ÿæ²¡æœ‰å¯è§æ€§ä¿è¯ï¼Œè¿™å°±å¯¼è‡´å¹¶å‘é—®é¢˜äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/60/be/60551e006fca96f581f3dc25424226be.png" alt=""></p><center><span class="reference">ä¸¤æŠŠé”ä¿æŠ¤ä¸€ä¸ªèµ„æºçš„ç¤ºæ„å›¾</span></center><h2>æ€»ç»“</h2><p>äº’æ–¥é”ï¼Œåœ¨å¹¶å‘é¢†åŸŸçš„çŸ¥ååº¦æé«˜ï¼Œåªè¦æœ‰äº†å¹¶å‘é—®é¢˜ï¼Œå¤§å®¶é¦–å…ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åŠ é”ï¼Œå› ä¸ºå¤§å®¶éƒ½çŸ¥é“ï¼ŒåŠ é”èƒ½å¤Ÿä¿è¯æ‰§è¡Œä¸´ç•ŒåŒºä»£ç çš„äº’æ–¥æ€§ã€‚è¿™æ ·ç†è§£è™½ç„¶æ­£ç¡®ï¼Œä½†æ˜¯å´ä¸èƒ½å¤ŸæŒ‡å¯¼ä½ çœŸæ­£ç”¨å¥½äº’æ–¥é”ã€‚ä¸´ç•ŒåŒºçš„ä»£ç æ˜¯æ“ä½œå—ä¿æŠ¤èµ„æºçš„è·¯å¾„ï¼Œç±»ä¼¼äºçƒåœºçš„å…¥å£ï¼Œå…¥å£ä¸€å®šè¦æ£€ç¥¨ï¼Œä¹Ÿå°±æ˜¯è¦åŠ é”ï¼Œä½†ä¸æ˜¯éšä¾¿ä¸€æŠŠé”éƒ½èƒ½æœ‰æ•ˆã€‚æ‰€ä»¥å¿…é¡»æ·±å…¥åˆ†æé”å®šçš„å¯¹è±¡å’Œå—ä¿æŠ¤èµ„æºçš„å…³ç³»ï¼Œç»¼åˆè€ƒè™‘å—ä¿æŠ¤èµ„æºçš„è®¿é—®è·¯å¾„ï¼Œå¤šæ–¹é¢è€ƒé‡æ‰èƒ½ç”¨å¥½äº’æ–¥é”ã€‚</p><p>synchronizedæ˜¯Javaåœ¨è¯­è¨€å±‚é¢æä¾›çš„äº’æ–¥åŸè¯­ï¼Œå…¶å®Javaé‡Œé¢è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»å‹çš„é”ï¼Œä½†ä½œä¸ºäº’æ–¥é”ï¼ŒåŸç†éƒ½æ˜¯ç›¸é€šçš„ï¼šé”ï¼Œä¸€å®šæœ‰ä¸€ä¸ªè¦é”å®šçš„å¯¹è±¡ï¼Œè‡³äºè¿™ä¸ªé”å®šçš„å¯¹è±¡è¦ä¿æŠ¤çš„èµ„æºä»¥åŠåœ¨å“ªé‡ŒåŠ é”/è§£é”ï¼Œå°±å±äºè®¾è®¡å±‚é¢çš„äº‹æƒ…äº†ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>ä¸‹é¢çš„ä»£ç ç”¨synchronizedä¿®é¥°ä»£ç å—æ¥å°è¯•è§£å†³å¹¶å‘é—®é¢˜ï¼Œä½ è§‰å¾—è¿™ä¸ªä½¿ç”¨æ–¹å¼æ­£ç¡®å—ï¼Ÿæœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿèƒ½è§£å†³å¯è§æ€§å’ŒåŸå­æ€§é—®é¢˜å—ï¼Ÿ</p><pre><code>class SafeCalc {
  long value = 0L;
  long get() {
    synchronized (new Object()) {
      return value;
    }
  }
  void addOne() {
    synchronized (new Object()) {
      value += 1;
    }
  }
}
</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><h2>çŒœä½ å–œæ¬¢</h2><p><a href="https://time.geekbang.org/course/intro/156?utm_term=zeusRVDGT&amp;utm_source=app&amp;utm_medium=javabingfabiancheng&amp;utm_campaign=156-onsell&amp;utm_content=banner0301"><img src="https://static001.geekbang.org/resource/image/8e/93/8e1906fb8a24d5eb66539fa88ea56193.png" alt="unpreview"></a></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            nonohony  2019-03-05 08:50:38
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            åŠ é”æœ¬è´¨å°±æ˜¯åœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­å†™å…¥å½“å‰çº¿ç¨‹idï¼Œä½†æ˜¯new objectæ¯æ¬¡åœ¨å†…å­˜ä¸­éƒ½æ˜¯æ–°å¯¹è±¡ï¼Œæ‰€ä»¥åŠ é”æ— æ•ˆã€‚ [117èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 21:47:23</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">synchronizedçš„å®ç°éƒ½çŸ¥é“äº†ï¼Œå‰å®³ï¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            zyl  2019-03-05 11:52:35
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            syncé”çš„å¯¹è±¡monitoræŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªObjectMonitorå¯¹è±¡ï¼Œæ‰€æœ‰çº¿ç¨‹åŠ å…¥ä»–çš„entrylisté‡Œé¢ï¼Œå»casæŠ¢é”ï¼Œæ›´æ”¹stateåŠ 1æ‹¿é”ï¼Œæ‰§è¡Œå®Œä»£ç ï¼Œé‡Šæ”¾é”stateå‡1ï¼Œå’Œaqsæœºåˆ¶å·®ä¸å¤šï¼Œåªæ˜¯æ‰€æœ‰çº¿ç¨‹ä¸é˜»å¡ï¼ŒcasæŠ¢é”ï¼Œæ²¡æœ‰é˜Ÿåˆ—ï¼Œå±äºéå…¬å¹³é”ã€‚<br>waitçš„æ—¶å€™ï¼Œçº¿ç¨‹è¿›waitsetä¼‘çœ ï¼Œç­‰å¾…notifyå”¤é†’<br><br> [30èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 22:11:20</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">syncçš„ä¼˜åŒ–éƒ½çŸ¥é“äº†ï¼Œå‰å®³å•Š</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ¢ç´¢æ— æ­¢å¢ƒ  2019-03-05 07:21:17
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸èƒ½ï¼Œå› ä¸ºnewäº†ï¼Œæ‰€ä»¥ä¸æ˜¯åŒä¸€æŠŠé”ã€‚è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘å¯¹é‚£ synchronizedçš„ç†è§£æ˜¯è¿™æ ·ï¼Œå®ƒå¹¶ä¸èƒ½æ”¹å˜CPUæ—¶é—´ç‰‡åˆ‡æ¢çš„ç‰¹ç‚¹ï¼Œåªæ˜¯å½“å…¶ä»–çº¿ç¨‹è¦è®¿é—®è¿™ä¸ªèµ„æºæ—¶ï¼Œå‘ç°é”è¿˜æœªé‡Šæ”¾ï¼Œæ‰€ä»¥åªèƒ½åœ¨å¤–é¢ç­‰å¾…ï¼Œä¸çŸ¥é“ç†è§£æ˜¯å¦æ­£ç¡® [28èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 20:21:57</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ç†è§£æ­£ç¡®ï¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            w1sl1y  2019-03-05 22:55:02
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ç»è¿‡JVMé€ƒé€¸åˆ†æçš„ä¼˜åŒ–åï¼Œè¿™ä¸ªsyncä»£ç ç›´æ¥ä¼šè¢«ä¼˜åŒ–æ‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶è¯¥ä»£ç å—æ˜¯æ— é”çš„ [27èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-06 08:07:55</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘å‰å®³<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç‹å¤§ç‹  2019-03-05 09:34:04
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            Getæ–¹æ³•åŠ é”ä¸æ˜¯ä¸ºäº†è§£å†³åŸå­æ€§é—®é¢˜ï¼Œè¿™ä¸ªè¯»æ“ä½œæœ¬èº«å°±æ˜¯åŸå­æ€§çš„ï¼Œæ˜¯ä¸ºäº†å®ç°ä¸èƒ½çº¿ç¨‹é—´addoneæ–¹æ³•çš„æ“ä½œç»“æœå¯¹getæ–¹æ³•å¯è§ï¼Œé‚£ä¹ˆvalueå˜é‡åŠ volitileä¹Ÿå¯ä»¥å®ç°åŒæ ·æ•ˆæœå—ï¼Ÿ [19èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 22:00:35</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ˜¯çš„ï¼Œå¹¶å‘åŒ…é‡Œçš„åŸå­ç±»éƒ½æ˜¯é å®ƒå®ç°çš„</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è€æ¨åŒå¿—  2019-03-05 09:16:54
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸¤æŠŠä¸åŒçš„é”ï¼Œä¸èƒ½ä¿æŠ¤ä¸´ç•Œèµ„æºã€‚è€Œä¸”è¿™ç§newå‡ºæ¥åªåœ¨ä¸€ä¸ªåœ°æ–¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½å¯¹å®ƒè§£é”ï¼Œè¿™ä¸ªé”ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰ã€‚å’Œæ²¡æœ‰syncronizedä»£ç å—æ•ˆæœæ˜¯ç›¸åŒçš„ [15èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 21:57:45</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å®åœ¨æ˜¯å¤ªå‰å®³äº†ï¼ï¼ï¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å¤§å—ç“œ  2019-03-05 00:13:43
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ²™å‘ï¼Œå¹¶ä¸èƒ½ï¼Œä¸æ˜¯åŒä¸€æŠŠé” [8èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 20:11:37</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä¸ºå¿«ç‚¹èµ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            çŸ³å¤´å‰ªåˆ€å¸ƒ  2019-03-08 23:06:22
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆè¯´ï¼šç°å®ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šæŠŠé”æ¥ä¿æŠ¤åŒä¸€ä¸ªèµ„æºï¼Œä½†åœ¨å¹¶å‘é¢†åŸŸæ˜¯ä¸è¡Œçš„ã€‚<br>ä¸èƒ½ç”¨ä¸¤æŠŠé”é”å®šåŒä¸€ä¸ªèµ„æºå—ï¼Ÿ<br>å¦‚ä¸‹ä»£ç ï¼š<br>public class X {<br>    private Object lock1 = new Object();<br>    private Object lock2 = new Object();<br>    private int value = 0;<br><br>    private void addOne() {<br>        synchronized (lock1) {<br>            synchronized (lock2) {<br>                value += 1;<br>            }<br>        }<br>    }<br><br>    private int get() {<br>        synchronized (lock1) {<br>            synchronized (lock2) {<br>                return value;<br>            }<br>        }<br>    }<br>}<br><br>è™½ç„¶è¯´è¿™æ ·åšæ²¡æœ‰å®é™…æ„ä¹‰ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”æˆ–è€…å…¶ä»–ä¸å¥½çš„ç»“æœå§ï¼Ÿè¯·è€å¸ˆæŒ‡å¯¼ï¼Œè°¢è°¢ã€‚<br> [6èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-09 08:26:25</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä½ è¿™ä¹ˆä¼˜ç§€ï¼Œæˆ‘è¯¥æ€ä¹ˆæŒ‡å¯¼å‘¢ï¼Ÿä½ è¿™ä¸æ˜¯ç”¨lock1 ä¿æŠ¤ lock2ï¼Œlock2ä¿æŠ¤valueå—ï¼Ÿå¾ˆç¬¦åˆæˆ‘ä»¬çš„åŸåˆ™ã€‚æˆ‘æ€ä¹ˆæ²¡æƒ³åˆ°å‘¢ï¼Ÿ<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å°å’Œå°šç¬¨å—åŒ—  2019-03-05 22:04:12
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸æ­£ç¡®<br>ä½¿ç”¨é”ä¿æŠ¤èµ„æºæ—¶ï¼Œå¯¹èµ„æºçš„æ‰€æœ‰æ“ä½œåº”è¯¥ä½¿ç”¨åŒä¸€ä¸ªé”ï¼Œè¿™æ ·æ‰èƒ½èµ·åˆ°ä¿æŠ¤çš„ä½œç”¨ã€‚<br>è¯¾åé¢˜ä¸­æ¯ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„æ“ä½œéƒ½æ˜¯ç”¨çš„æ˜¯å„è‡ªçš„é”ï¼Œä¸å­˜åœ¨äº’æ–¥å’Œç«äº‰çš„æƒ…å†µã€‚<br>è¿™å°±ç›¸å½“äºæœ‰ä¸€ä¸ªæˆ¿é—´ï¼Œæ¯ä¸ªäººè¿‡æ¥éƒ½å®‰è£…ä¸€ä¸ªé—¨ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±é—¨çš„é’¥åŒ™ï¼Œå¤§å®¶éƒ½å¯ä»¥éšæ„å‡ºå…¥è¿™ä¸ªæˆ¿é—´ã€‚<br>ç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥éšæ—¶è¿›å…¥æ–¹æ³•ï¼Œæ‰€ä»¥å­˜åœ¨åŸå­æ€§é—®é¢˜ï¼›<br>ä½†æ˜¯å› ä¸ºæ¯æ¬¡éƒ½æœ‰åŠ é”å’Œè§£é”çš„æ“ä½œï¼Œunlockæ“ä½œä¼šä½¿å…¶ä»–ç¼“å­˜çš„å˜é‡å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ä»ä¸»å†…å­˜ä¸­åŠ è½½å˜é‡çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥è§£å†³å¯è§æ€§é—®é¢˜ã€‚<br>å¦‚æœ‰é”™è¯¯ï¼Œè¯·è€å¸ˆæŒ‡æ­£ã€‚ [6èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-06 08:30:27</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ¯”å–»å¾ˆç”ŸåŠ¨</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è½è½å½©è™¹  2019-03-10 09:31:32
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆçš„æ–‡ç« æˆ‘éƒ½è¦çœ‹å‡ é.è¯„è®ºåŒºä¹Ÿä¸æ•¢æ”¾è¿‡.<br><br>è¯„è®ºåŒºæœ‰äº›demoï¼Œæ³¨æ„å…³äºjoinçš„hbåŸåˆ™ï¼›æ³¨æ„system.out.printlnå¯¹å¯è§æ€§çš„å½±å“ï¼Œè¯¥æ–¹æ³•å†…éƒ¨åŠ é”äº†.<br>è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä¸ç”¨joinï¼Œè€Œæ˜¯sleepè¶³å¤Ÿé•¿æ—¶é—´ä»¥ç¡®ä¿çº¿ç¨‹è·‘å®Œäº†ï¼Œä¹Ÿèƒ½ä¿è¯å¯è§æ€§.å› ä¸ºçº¿ç¨‹ç»“æŸäº†ä»–çš„æœ¬åœ°å·¥ä½œç©ºé—´è¯¥é‡Šæ”¾äº†ï¼Œæ•°æ®è¦å¼ºåˆ¶åˆ·å›å†…å­˜äº†â€¦â€¦è¿™ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯joinçš„hbåŸåˆ™å—ï¼Ÿæˆ‘çœ‹ç½‘ä¸Šè¯´åˆ°hbéƒ½ä¼šæŠŠjoinçš„é‚£ä¸ªåŸåˆ™è¯´æˆæ˜¯çº¿ç¨‹ç»ˆæ­¢è§„åˆ™.<br> [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-10 12:04:11</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ„Ÿè°¢ä¸ç¦»ä¸å¼ƒå•Š<br>æµ‹è¯•çš„æ—¶å€™ç»å¸¸ç”¨sleepï¼Œå®é™…é¡¹ç›®è¿˜æ˜¯ç”¨joinå§ã€‚è¿™ä¸ªæˆ‘æ„Ÿè§‰ä¸èƒ½è®¤ä¸ºæ˜¯joinåŸåˆ™ã€‚è§„èŒƒé‡Œç¡®å®æ²¡æœ‰ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            é™ˆå  2019-03-07 17:59:26
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æˆ‘ç†è§£getæ–¹æ³•ä¸éœ€è¦åŠ synchroizedå…³é”®å­—ï¼Œä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ã€‚<br>å› ä¸º å¯¹ valueçš„å†™æœ‰è¢« synchroized ä¿®é¥°ï¼ŒaddOneï¼ˆï¼‰æ–¹æ³•ç»“æŸåï¼Œä¼šå¼ºåˆ¶å…¶ä»–CPUç¼“å­˜å¤±æ•ˆï¼Œä»æ–°ä»å†…å­˜è¯»å–æœ€æ–°å€¼ï¼<br><br>class SafeCalc {<br>  long value = 0L;<br>  long get() {<br>    return value;<br>  }<br>  synchronized void addOne() {<br>    value += 1;<br>  }<br>}<br> [3èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-07 20:40:16</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä½ è¯´çš„å¯¹ï¼Œä»å®ç°ä¸Šçœ‹æ˜¯è¿™æ ·ã€‚ä½†æ˜¯hbæ²¡æœ‰è¿™æ ·çš„è¦æ±‚<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            churchchen  2019-03-06 22:05:08
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            class SafeCalc {<br>  static long value = 0L;<br>  synchronized long get() {<br>    return value;<br>  }<br>  synchronized static void addOne() {<br>    value += 1;<br>  }<br>}<br><br><br>get()æ–¹æ³•çš„å¯è§æ€§ä¸å¤ªç†è§£ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯ [3èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-07 19:23:40</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">getå’Œaddoneé”çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»“åˆä¸Šä¸€æœŸçš„hbè§„åˆ™å†æƒ³æƒ³<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ChallengeND  2019-03-05 09:37:01
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            synchronizedçš„åŠ é”è§£é”ï¼Œå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæ²¡æœ‰è®² [3èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 22:01:17</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æœ‰å…´è¶£çš„è‡ªå·±æ‰¾èµ„æ–™çœ‹å§</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åˆ«çš±çœ‰  2019-03-13 15:11:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œæˆ‘è§‰å¾—getæ–¹æ³•æœ‰å¿…è¦ç”¨åŠ é”æ¥ä¿è¯å¯è§æ€§çš„å¦ä¸€ä¸ªç†ç”±å¦‚ä¸‹:<br>class SafeCalc {<br>	long value = 0L;<br><br>	synchronized long get() {<br>		return value;<br>	}<br><br>	synchronized void add(int i) {<br>		&#47;&#47; ä¸šåŠ¡ä»£ç ....å‡å¦‚è¿™é‡Œæ¯”è¾ƒè€—æ—¶<br>		value += i;<br>	}<br>}<br><br>å‡å¦‚çº¿ç¨‹Aæ‰§è¡Œaddæ–¹æ³• å½“æ–¹æ³•è¿˜æ²¡æ‰§è¡Œå®Œ<br>çº¿ç¨‹Bæ‰§è¡Œgetæ–¹æ³• <br>å¦‚æœgetæ–¹æ³•æ²¡æœ‰åŠ é” å› ä¸ºæ­¤æ—¶Aæ­£åœ¨ä¿®æ”¹è¿™ä¸ªæ•°æ®  Bè·å–çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„ <br><br>æ‚¨çœ‹æˆ‘è¯´çš„å¯¹å—ï¼Ÿè¿˜æ˜¯è¯´å…·ä½“åœºæ™¯æœ‰ä¸åŒçš„éœ€æ±‚ï¼Œæœ‰äº›è¿˜æ˜¯å…è®¸è¿™ç‚¹å»¶è¿Ÿçš„ï¼Ÿ<br>æœ¬äººå¤§ä¸‰ï¼Œè¯·å‰è¾ˆå¤šæŒ‡æ•™ğŸ˜ğŸ˜è°¢è°¢<br> [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-13 20:22:59</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æˆ‘è§‰å¾—ä½ è¿™ä¸ªæ‰æ˜¯æ­£é“ï¼Œå¹¶å‘é—®é¢˜å°å¿ƒè¿˜èº²ä¸è¿‡å‘¢ï¼Œå“ªé‡Œæ•¢å†’é™©å•Šï¼æ²¡æƒ³åˆ°è¿˜æœ‰å­¦ç”Ÿçœ‹è¿™ä¸ªä¸“æ ï¼Œæœ‰å‰é€”ğŸ‘<br><br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            hxy  2019-03-06 20:45:44
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆè¯·é—®synchronizedä¿®é¥°çš„ä¸´ç•ŒåŒºä¸­ï¼Œå¦‚æœä¸æ˜¯åŒä¸€æŠŠé”ï¼Œèƒ½ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§å—ï¼Ÿ<br>    private final static int cnt = 10000;<br>    private static int tmp = 0;<br><br>    public static void main(String[] args) {<br><br>        Object lock1 = new Object();<br>        Object lock2 = new Object();<br><br>        Thread thread1 = new Thread(() -&gt; {<br>            synchronized (lock1) {<br>                for (int i = 0; i &lt; cnt; i++) {<br>                    tmp++;<br>                }<br>            }<br>        });<br>        Thread thread2 = new Thread(() -&gt; {<br>            Watch.slp(10L);<br>            synchronized (lock2) {<br>                System.out.println(&quot;tmp is: &quot; + tmp);<br>            }<br>        });<br><br>        thread2.start();<br>        thread1.start();<br>    }<br>æˆ‘è¿™æ ·è¯•äº†ä¸€ä¸‹ï¼Œthread2æœ€åè¯»çš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œæ„Ÿè§‰æœ‰ä¸€ç‚¹å¥‡æ€ª [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-06 22:28:12</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">è¿™ç§ç®€å•æƒ…å†µï¼Œå®é™…ä¸Šå‡ºbugçš„æ¦‚ç‡è¿˜çœŸæ˜¯å¾ˆä½ã€‚ä½†æ˜¯ä½ä¸æ„å‘³ç€æ­£ç¡®ã€‚<br>ä¹Ÿä¸ç”¨å¥‡æ€ªï¼Œæˆ‘ä»¬æ‰€è¯´çš„éƒ½æ˜¯å¯èƒ½ã€‚é”ä¸¤ä¸ªå¯¹è±¡ï¼Œç¼–è¯‘å™¨å®˜æ–¹ä¸ä¿è¯å¯è§æ€§ï¼Œç§ä¸‹é‡Œä¹Ÿè®¸èƒ½ä¿è¯ã€‚æˆ‘ä»¬ä¸èƒ½ä¾èµ–äºç§ä¸‹çš„æ–¹æ¡ˆã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å°é»„  2019-03-05 08:57:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ˜æ˜¾getOne å’Œ addOne æ¯æ¬¡åŠ é”åœ¨ä¸åŒèµ„æºä¸Šï¼Œå¹¶æ²¡æœ‰å½¢æˆäº’æ–¥ [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-05 20:17:31</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Mr.Panda  2019-03-31 11:36:17
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆæ‚¨å¥½ï¼Œæœ›ç­”ç–‘<br>æ¦‚å¿µï¼šâ€œåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œâ€è¿™ä¸ªæ¡ä»¶éå¸¸é‡è¦ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºäº’æ–¥<br>ç–‘æƒ‘:  ä¸€æ®µå…³æ³¨ä»£ç (å¤šä¸ªæ“ä½œæŒ‡ä»¤)åªèƒ½ç”±ä¸ªä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå°±ç®—ä¸­é—´å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¸èƒ½æ‰§è¡Œè¿™æ®µä»£ç ï¼Œæ‰å«äº’æ–¥å§ <br> [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-31 18:52:02</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä½ è¯´çš„æ˜¯å¯¹çš„ï¼Œè€Œä¸”æ›´ä¸¥è°¨ã€‚ä½†æ˜¯ç«™åœ¨åº”ç”¨çš„è§’åº¦ï¼Œä¸€èˆ¬éƒ½å¿½ç•¥æ‰è¿™äº›ç»†èŠ‚ï¼Œè¿™æ ·åœ¨å¤§è„‘é‡Œæ¨æ¼”ç¨‹åºçš„æ‰§è¡Œä¼šæ›´å®¹æ˜“ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä¾¯å¤§è™  2019-03-30 21:33:37
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œæœ‰ä¸ªå°é—®é¢˜  classé”é”çš„æ˜¯è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹ï¼Œå’Œthisä¸åº”è¯¥æ˜¯åŒä¸€æŠŠé”å—(thisä¸å°±æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹å—)ï¼Ÿ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-31 07:31:40</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ²¡æœ‰åŒ…å«å…³ç³»ï¼Œå°±åƒå…¬äº¤å¡å’Œå•æ¬¡ç¥¨ä¸€æ ·ï¼Œéƒ½èƒ½åè½¦<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Monster!  2019-03-28 22:55:41
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
             private volatile Long count = 0L;<br>    private  void add(){<br>        int add = 0;<br>        while (add++&lt;10000){<br>            count ++;<br>        }<br>    }<br>    public static Long calc() throws InterruptedException {<br>        ThreadCountTest threadCountTest = new ThreadCountTest();<br>        Thread thread1 = new Thread(()-&gt;{<br>            threadCountTest.add();<br>        });<br>        Thread thread2 = new Thread(() -&gt; {<br>            threadCountTest.add();<br>        });<br>        &#47;&#47;å¼€å¯ä¸¤ä¸ªçº¿ç¨‹<br>        thread1.start();<br>        thread2.start();<br>        &#47;&#47;ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹ç»“æŸ<br>        &#47;*thread1.join();<br>        thread2.join();*&#47;<br><br>        return threadCountTest.count;<br>    }<br>ç‹è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œæ ¹æ®ä¸Šä¸€èŠ‚çš„æ€è€ƒé¢˜ï¼Œå¦‚æœè¦æƒ³è®©çº¿ç¨‹Aå¯¹å…±äº«èµ„æºçš„ä¿®æ”¹å¯¹çº¿ç¨‹Bå¯è§å…¶ä¸­ä¸€ç§æ–¹æ³•å°±æ˜¯åœ¨å…±äº«å˜é‡ä¸ŠåŠ volatileå…³é”®å­—ï¼Œå¦‚ä¸Šè¿°ä»£ç åœ¨æ³¨é‡Šæ‰ä¸¤ä¸ªæ–¹æ³•çš„join()æ—¶å¾—å‡ºçš„ç»“æœä¸º0ï¼Œæ”¾å¼€ä¸¤ä¸ªjoin()æ–¹æ³•åå¾—å‡ºçš„ç»“æœåˆæ˜¯éšæœºçš„ï¼Œè¿™ä¸ªé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-28 23:14:12</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">é‚£ä¸¤ä¸ªçº¿ç¨‹è¿˜æ²¡æ¥å¾—åŠè·‘ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œåˆ°return threadCountTest.count;äº†</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åˆ«çš±çœ‰  2019-03-17 13:23:57
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ç›¸ä¿¡å¾ˆå¤šäººè·Ÿæˆ‘ä¸€æ ·ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜,è¯„è®ºé‡Œä¹Ÿçœ‹åˆ°æœ‰äººåœ¨é—®ï¼Œå†…å®¹æœ‰ç‚¹é•¿ï¼Œè¾›è‹¦è€å¸ˆå¸®å¿™å¤§å®¶åˆ†æä¸‹äº† å“ˆå“ˆ<br>Â Â ---------------------------------------------------------<br>public class A implements Runnable {<br>Â Â Â  public Integer b = 1;<br>Â <br>Â Â Â  @Override<br>Â Â Â  public void run() {<br>Â Â Â Â Â Â  System.out.println(&quot;A is begin!&quot;);<br>Â Â Â Â Â Â  while (true) {<br>               System.out.println(&quot;a&quot;);<br>Â Â Â Â Â Â Â Â Â Â  &#47;&#47; System.out.println(b);<br>Â Â Â Â Â Â Â Â Â Â  if (b.equals(2))<br>Â Â Â Â Â Â Â Â Â Â Â Â Â  break;<br>Â Â Â Â Â Â  }<br>Â <br>Â Â Â Â Â Â  System.out.println(&quot;A is finish!&quot;);<br>Â Â Â  }<br>Â <br>Â Â Â  public static void main(String[] args) {<br>Â Â Â Â Â Â  A a = new A();<br>Â Â Â Â Â Â  &#47;&#47;çº¿ç¨‹A<br>Â Â Â Â Â Â  new Thread(a).start();<br>Â Â Â Â Â Â  try {<br>Â Â Â Â Â Â Â Â Â Â  Thread.sleep(1000);<br>Â Â Â Â Â Â  } catch (InterruptedException e) {<br>Â Â Â Â Â Â Â Â Â Â  e.printStackTrace();<br>Â Â Â Â Â Â  }<br>Â Â Â Â Â Â  a.b = 2;<br>Â Â Â  }<br>}<br>Â <br>æˆ‘ä»¬çŸ¥é“è¿™ä¸ªç¨‹åºä¼šå‡ºç°å¯è§æ€§é—®é¢˜ã€‚<br>ä½†æ˜¯åœ¨whileå†…åŠ ä¸ŠSystem.out.println(b)å å½“ä¸»çº¿ç¨‹ä¿®æ”¹bçš„å€¼å çº¿ç¨‹Aå±…ç„¶èƒ½å¤Ÿå–å¾—æœ€æ–°å€¼ å¯è§æ€§é—®é¢˜å¾—åˆ°è§£å†³<br>System.out.println(b)çš„å®ç°å¦‚ä¸‹<br>Â Â Â  public void println(String x) {<br>Â Â Â Â Â Â Â  synchronized (this) {<br>Â Â Â Â Â Â Â Â Â Â Â  print(x);<br>Â Â Â Â Â Â Â Â Â Â Â  newLine();<br>Â Â Â Â Â Â Â  }<br>Â Â Â  }<br>Â <br>Doug Leaå¤§ç¥çš„Concurrent Programming in Javaä¸€ä¹¦ä¸­æœ‰è¿™æ ·ä¸€ä¸ªç‰‡æ®µæ¥æè¿°synchronizedè¿™ä¸ªå…³é”®å­—ï¼š<br>Â <br>è¿™é‡Œè‹±æ–‡å°±ä¸æ”¾å‡ºæ¥äº† å­—æ•°è¶…è¿‡ä¸¤åƒâ€¦â€¦<br>è¿™ç¯‡æ–‡ç« ä¹Ÿæœ‰æåŠhttps:&#47;&#47;www.jianshu.com&#47;p&#47;3c06ffbf0d52<br>Â <br>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼šä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå½“çº¿ç¨‹é‡Šæ”¾ä¸€ä¸ªé”æ—¶ä¼šå¼ºåˆ¶æ€§çš„å°†å·¥ä½œå†…å­˜ä¸­ä¹‹å‰æ‰€æœ‰çš„å†™æ“ä½œéƒ½åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ï¼Œè€Œè·å–ä¸€ä¸ªé”åˆ™ä¼šå¼ºåˆ¶æ€§çš„åŠ è½½å¯è®¿é—®åˆ°çš„å€¼åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­æ¥ã€‚è™½ç„¶é”æ“ä½œåªå¯¹åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—è¿™ä¸€å—èµ·åˆ°ä½œç”¨ï¼Œä½†æ˜¯å½±å“çš„å´æ˜¯çº¿ç¨‹æ‰§è¡Œæ“ä½œæ‰€ä½¿ç”¨çš„æ‰€æœ‰å­—æ®µã€‚<br><br><br>ä¹Ÿå°±æ˜¯è¯´å½“è°ƒç”¨System.out.println(&quot;a&quot;)æ—¶å½“å‰çº¿ç¨‹çš„ç¼“å­˜ä¼šè¢«é‡æ–°åˆ·æ–°è¿‡ï¼Œæ‰€ä»¥æ‰èƒ½å¤Ÿè¯»åˆ°è¿™ä¸ªå€¼æœ€æ–°å€¼<br>Â ---------------------------------------------------------<br>ç„¶åé—®é¢˜æ¥äº†<br>é—®é¢˜1:<br>é¦–å…ˆä¸Šé¢çš„è¯´æ³•ä¸çŸ¥é“æ˜¯ä¸æ˜¯çœŸçš„æ˜¯è¿™æ ·ã€‚<br>ç„¶åæˆ‘åœ¨ä¸‹é¢åŠ äº†System.out.println(b) ç»“æœæ‰“å°å‡ºæ¥çš„æ˜¯æ—§å€¼ï¼Œä½†æ˜¯ä¸‹é¢çš„b.equals(2)å´èƒ½é€šè¿‡ è¿™é‡Œæ²¡å¼„æ˜ç™½ æˆ‘è§‰å¾—åº”è¯¥æ˜¯ç¼–è¯‘å™¨è¿›è¡Œäº†ä¼˜åŒ–?å› ä¸ºç°åœ¨å¤§ä¸‰èƒ½åŠ›ä¸å¤Ÿï¼Œè¿˜æ²¡å­¦ä¼šçœ‹classæ–‡ä»¶ æ²¡æ³•éªŒè¯<br>Â <br>é—®é¢˜2:<br>ç½‘ä¸Šæ‰¾äº†ä¸€äº›æ–‡ç« <br>æœ‰äº›äººçš„è¯´æ³•æ˜¯ï¼šæ‰“å°æ˜¯IOæ“ä½œï¼Œè€ŒIOæ“ä½œä¼šå¼•èµ·çº¿ç¨‹çš„åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢ä¼šå¯¼è‡´çº¿ç¨‹åŸæœ¬çš„ç¼“å­˜å¤±æ•ˆï¼Œä»è€Œä¹Ÿä¼šè¯»å–åˆ°ä¿®æ”¹åçš„å€¼ã€‚<br>Â <br>æˆ‘å°è¯•ç€å°†æ‰“å°æ¢æˆFile file = new File(&quot;D:&#47;&#47;1.txt&quot;);è¿™å¥ä»£ç ï¼Œç¨‹åºä¹Ÿèƒ½å¤Ÿæ­£å¸¸çš„ç»“æŸã€‚å½“ç„¶ï¼Œåœ¨è¿™é‡Œä¹Ÿå¯ä»¥å°è¯•å°†å°†æ‰“å°æ›¿æ¢æˆsynchronized(A.class){ }è¿™å¥ç©ºåŒæ­¥ä»£ç å—ï¼Œå‘ç°ç¨‹åºä¹Ÿèƒ½å¤Ÿæ­£å¸¸ç»“æŸã€‚<br>Â <br>è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ çº¿ç¨‹åˆ‡æ¢æ—¶ä¼šæŠŠä¹‹å‰æ“ä½œçš„ç›¸å…³æ•°æ®ä¿å­˜åˆ°å†…å­˜é‡Œï¼Œåˆ‡æ¢å›æ¥åä¼šæŠŠå†…å­˜é‡Œçš„æ•°æ®é‡æ–°åŠ è½½åˆ°å¯„å­˜å™¨é‡Œå—ï¼Œè¿™æ ·è¯´çš„è¯ å°±ç®—åˆ‡æ¢ä¹Ÿæ˜¯è·å–ä¸åˆ°ä¿®æ”¹åçš„å€¼çš„,ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåšåˆ°èƒ½å¤Ÿè¯»åˆ°è¿™ä¸ªä¿®æ”¹åçš„å€¼çš„ï¼Ÿ<br>Â <br>é—®é¢˜3:<br>æ˜¯ä¸æ˜¯<br>çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šéšæœºæ€§çš„æŠŠç¼“å­˜åˆ·åˆ°å†…å­˜<br>çº¿ç¨‹ç»“æŸåä¸€å®šä¼šæŠŠç¼“å­˜é‡Œçš„æ•°æ®åˆ·åˆ°å†…å­˜<br><br>Â ---------------------------------------------------------<br>åœ¨è¯„è®ºé‡Œå¥½å¤šå¤§ç¥ èƒ½å­¦åˆ°å¥½å¤šä¸œè¥¿ğŸ˜„ğŸ˜„ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-17 15:43:46</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">1. printlnçš„ä»£ç é‡Œé”çš„thisæŒ‡çš„æ˜¯ä½ çš„æ§åˆ¶å°ï¼Œè¿™ä¸ªé”è·Ÿä½ çš„ä»£ç æ²¡å…³ç³»ï¼Œè€Œä¸”printlné‡Œä¹Ÿæ²¡æœ‰å†™æ“ä½œï¼Œæ‰€ä»¥printlnä¸ä¼šå¯¼è‡´å¼ºåˆ·ç¼“å­˜ã€‚<br><br>æˆ‘è§‰å¾—æ˜¯å› ä¸ºprintlnäº§ç”Ÿäº†IOï¼ŒIOç›¸å¯¹CPUæ¥è¯´ï¼Œå¤ªæ…¢ï¼Œæ‰€ä»¥è¿™ä¸ªæœŸé—´å¤§æ¦‚ç‡çš„ä¼šæŠŠç¼“å­˜çš„å€¼å†™å…¥å†…å­˜ã€‚ä¹Ÿæœ‰å¯èƒ½è¿™ä¸ªçº¿ç¨‹è¢«è°ƒåº¦åˆ°äº†å…¶ä»–çš„CPUä¸Šï¼Œå‹æ ¹æ²¡æœ‰ç¼“å­˜ï¼Œæ‰€ä»¥åªèƒ½ä»å†…å­˜å–æ•°ã€‚ä½ è°ƒç”¨sleepï¼Œæ•ˆæœåº”è¯¥ä¹Ÿå·®ä¸å¤šã€‚<br><br>2. çº¿ç¨‹åˆ‡æ¢æ˜¾ç„¶ä¸è¶³ä»¥ä¿è¯å¯è§æ€§ï¼Œä¿è¯çš„å¯è§æ€§åªèƒ½é hbè§„åˆ™ã€‚<br><br>3. çº¿ç¨‹ç»“æŸåï¼Œä¸ä¸€å®šä¼šå¼ºåˆ·ç¼“å­˜ã€‚å¦åˆ™Joinçš„è§„åˆ™å°±æ²¡å¿…è¦äº†<br><br>å¹¶å‘é—®é¢˜æœ¬æ¥å°±æ˜¯å°æ¦‚ç‡çš„äº‹ä»¶ï¼Œå°¤å…¶æœ‰äº†IOæ“ä½œä¹‹åï¼Œæ¦‚ç‡å°±æ›´ä½äº†ã€‚</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>